---
import Layout from "../../components/Layout.astro";
import CTA from "../../components/CTA.astro";

import villes from "../../data/villes.json";
import domaines from "../../data/domaines.json";

import { buildTitle, metaDescription } from "../../lib/seo";

export function getStaticPaths() {
  return villes.map((v) => ({
    params: { slug: v.slug },
    props: { v },
  }));
}

const { v } = Astro.props;

// SEO
const title = buildTitle([`Avocats à ${v.nom}`, "SEO local & prise de contact", "Horizon Conversion"]);
const description = metaDescription(
  `Structuration SEO local pour cabinets d’avocats à ${v.nom} (dépt. ${v.departement}) : pages utiles, maillage domaine/ville et suivi des demandes.`
);

// Breadcrumbs
const crumbs = [
  { name: "Accueil", url: "/" },
  { name: "Villes", url: "/villes" }, // optionnel : tu peux créer /villes/index plus tard
  { name: v.nom, url: `/villes/${v.slug}` },
];

const breadcrumbSchema = {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  itemListElement: crumbs.map((c, idx) => ({
    "@type": "ListItem",
    position: idx + 1,
    name: c.name,
    item: new URL(c.url, Astro.url.origin).toString(),
  })),
};
---
<Layout title={title} description={description}>
  <script type="application/ld+json">{JSON.stringify(breadcrumbSchema)}</script>

  <section>
    <nav aria-label="Fil d’Ariane">
      <ol>
        {crumbs.map((c, i) => (
          <li>
            {i < crumbs.length - 1 ? <a href={c.url}>{c.name}</a> : <span aria-current="page">{c.name}</span>}
          </li>
        ))}
      </ol>
    </nav>

    <h1>Cabinets d’avocats à {v.nom} : visibilité Google et prise de contact</h1>

    <p>
      Cette page sert de point d’entrée “local” : elle organise les services (domaines) et renvoie vers des pages
      dédiées, afin de faciliter la compréhension pour l’utilisateur et le crawl par Google.
    </p>

    <div class="grid">
      <div>
        <h2>Ce qu’on structure</h2>
        <ul>
          <li>Pages service claires + pages locales utiles</li>
          <li>Maillage interne cohérent : domaine → ville → contact</li>
          <li>Suivi des demandes : formulaires, clics d’appel, sources (UTM)</li>
        </ul>
      </div>

      <div>
        <h2>Informations locales (sobres)</h2>
        <ul>
          <li>Département : {v.departement}</li>
          <li>Code postal : {v.code_postal}</li>
          <li>Zone : Sud Oise / Nord Val-d’Oise (selon ville)</li>
        </ul>
      </div>
    </div>

    <CTA
      label={`Demander un audit visibilité (${v.nom})`}
      href={`/contact?ville=${v.slug}`}
    />
  </section>

  <section>
    <h2>Domaines couverts à {v.nom}</h2>
    <p>
      Pages dédiées par domaine, avec une approche “information + prise de contact” (sans promesse de résultat).
    </p>

    <ul class="cards">
      {domaines.map((d) => (
        <li class="card">
          <h3><a href={`/${d.slug}/${v.slug}`}>{d.nom} à {v.nom}</a></h3>
          <p>
            Structure SEO local, contenus utiles, suivi des demandes et optimisations progressives.
          </p>
          <p class="links">
            <a href={`/domaines/${d.slug}`}>Voir le domaine</a>
            <span aria-hidden="true"> · </span>
            <a href={`/${d.slug}/${v.slug}`}>Voir la page locale</a>
          </p>
        </li>
      ))}
    </ul>
  </section>
</Layout>

<style>
  nav ol{display:flex;gap:8px;list-style:none;padding:0;flex-wrap:wrap}
  nav li::after{content:"›";margin-left:8px}
  nav li:last-child::after{content:""}

  .grid{display:grid;gap:16px;grid-template-columns:repeat(auto-fit,minmax(260px,1fr))}
  .cards{list-style:none;padding:0;display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(260px,1fr))}
  .card{border:1px solid #ddd;border-radius:12px;padding:12px}
  .links{margin:8px 0 0}
</style>