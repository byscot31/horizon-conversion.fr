---
// src/components/blocks/ResourcesGrid.astro
const { data, items = [] } = Astro.props as {
  data: any;
  items: Array<{
    slug: string;
    title: string;
    excerpt?: string;
    category?: string;
    readingTime?: string;
    date?: string;
    image?: { src: string; alt?: string };
  }>;
};

const header = data?.header ?? null;

const metaLineKeys: string[] = data?.card?.metaLineKeys ?? [];
const ctaLabel: string | undefined = data?.card?.cta?.label;
const id: string | undefined = data?.id;

// Layout optionnel (si tu veux piloter via JSON)
const sectionClass: string = data?.layout?.sectionClass ?? "section bg-transparent pt-0 pb-lg-0";
const containerClass: string = data?.layout?.containerClass ?? "container";
const rowClass: string = data?.layout?.rowClass ?? "row g-4";
const colClass: string = data?.layout?.colClass ?? "col-lg-4";
const cardClass: string = data?.layout?.cardClass ?? "card rounded-6 overflow-hidden";
const cardBodyClass: string = data?.layout?.cardBodyClass ?? "card-body p-3";
---

<div class={sectionClass} id={id}>
  <div class={containerClass}>

    {/* Header optionnel : badge + h2 + subtitle */}
    {(header?.badge || header?.title || header?.subtitle) && (
        <div class="row justify-content-center mb-4">
          <div class="col-lg-10">
            {header?.badge && (
                <p class="text-uppercase ls-3 text-smaller color mb-2 fw-bold">
                  {header.badge}
                </p>
            )}
            {header?.title && <h2 class="mb-2">{header.title}</h2>}
            {header?.subtitle && <p class="mb-4 op-07">{header.subtitle}</p>}
          </div>
        </div>
    )}

    <div class={rowClass}>
      {items.map((it) => {
        const metaLine = metaLineKeys
          .map((k) => (it as any)?.[k])
          .filter(Boolean)
          .join(" Â· ");

        return (
            <div class={colClass}>
              <div class="grid-inner">
                <div class={cardClass}>
                  <div class={cardBodyClass}>
                    {it?.image?.src && <img src={it.image.src} alt={it.image.alt ?? ""} />}

                    {metaLine && (
                        <p class="text-uppercase ls-3 text-smaller color mb-3 fw-bold">
                          {metaLine}
                        </p>
                    )}

                    {it?.title && <h2 class="h3 lh-sm">{it.title}</h2>}

                    {it?.excerpt && <p class="fw-light">{it.excerpt}</p>}

                    {ctaLabel && (
                        <a href={`/ressources/${it.slug}/`} class="btn btn-link p-0">
                          <u>{ctaLabel}</u>
                        </a>
                    )}
                  </div>
                </div>
              </div>
            </div>
        );
      })}
    </div>
  </div>
</div>