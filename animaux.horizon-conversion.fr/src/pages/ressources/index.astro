---
// src/pages/ressources/index.astro
import LayoutSeo from "../../layouts/LayoutSEO.astro";
import { getCollection } from "astro:content";

const ressources = await getCollection("ressources");

const hub =
  ressources.find((e) => e.data?.key === "hub:ressources") ??
  ressources.find((e) => e.id === "hub_ressources") ??
  null;

if (!hub) throw new Error("Missing hub_ressources.json (key: hub:ressources)");

const page = hub.data;

const categories = page.categories ?? [];
const featured = page.featured ?? [];

const title = page.metaTitle ?? "Ressources | Horizon Conversion Animaux";
const description = page.metaDescription ?? "";

// Breadcrumbs hub (pour JSON-LD)
const breadcrumbs = [{ label: "Ressources", href: "/ressources/" }];

// FAQ optionnelle (si ton JSON hub la fournit)
const faqs = page.faqs ?? null;
---

<LayoutSeo
    title={title}
    description={description}
    schemaType="page"
    pageTitleH1={page.pageTitleH1 ?? "Ressources"}
    breadcrumbs={breadcrumbs}
    faqs={faqs}
>
  <section class="section m-0" style="background-color:#eef2f5;">
    <div class="container">
      <div class="heading-block text-center border-bottom-0 mb-5 mt-4 mx-auto" style="max-width: 760px">
        <h1 class="text-transform-none font-secondary fw-normal" style="font-size: 40px;">
          <Fragment set:html={page.pageTitleH1 ?? "Ressources"} />
        </h1>
        <span>{page.pageTitleLead ?? ""}</span>
      </div>

      <div class="row align-items-stretch g-4">
        {categories.map((c) => (
            <div class="col-lg-3 col-md-6">
              <div class="feature-box media-box fbox-bg h-100">
                <div class="fbox-content border-0">
                  <h3 class="text-transform-none ls-0 fw-semibold">{c.title}</h3>
                  <p class="mb-0">{c.description}</p>
                  <a class="button-link border-0 color" href={c.href} data-cta="1">
                    {c.label ?? "Voir"}
                  </a>
                </div>
              </div>
            </div>
        ))}
      </div>

      {!!featured.length && (
          <>
            <div class="line my-5"></div>
            <div class="heading-block text-center border-bottom-0 mb-4 mx-auto" style="max-width: 760px">
              <h2 class="text-transform-none font-secondary fw-normal" style="font-size: 32px;">
                {page.featuredTitle ?? "Guides Ã  lire en premier"}
              </h2>
              <span>{page.featuredLead ?? ""}</span>
            </div>

            <div class="row g-4">
              {featured.map((it) => (
                  <div class="col-lg-4">
                    <div class="card border-light shadow-sm h-100">
                      <div class="card-body">
                        <h3 class="text-transform-none ls-0 fw-semibold mb-2">{it.title}</h3>
                        <p class="mb-3">{it.description}</p>
                        <a class="button-link border-0 color" href={it.href} data-cta="1">
                          {it.label ?? "Lire"}
                        </a>
                      </div>
                    </div>
                  </div>
              ))}
            </div>
          </>
      )}
    </div>
  </section>
</LayoutSeo>
