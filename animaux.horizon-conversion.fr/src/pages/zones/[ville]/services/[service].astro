---
// src/pages/zones/[ville]/services/[service].astro
import LayoutSEO from "../../../../layouts/LayoutSEO.astro";
import { SERVICES, type ServiceKey } from "../../../../data/services.ts";
import { VILLES, ZONES, slugifyCity, findCityBySlug, type ZoneKey } from "../../../../data/zones.ts";

export const prerender = true;
const baseUrl = "https://animaux.horizon-conversion.fr";

export function getStaticPaths() {
  const serviceKeys = Object.keys(SERVICES) as ServiceKey[];
  const paths = [];
  for (const v of VILLES) {
    const villeSlug = slugifyCity(v.town);
    for (const service of serviceKeys) {
      paths.push({
        params: { ville: villeSlug, service },
        props: { town: v.town, zoneKey: v.zoneKey, service },
      });
    }
  }
  return paths;
}

const { ville, service } = Astro.params as { ville: string; service: string };
const props = Astro.props as { town?: string; zoneKey?: ZoneKey; service?: ServiceKey };

const resolvedCity =
  props?.town && props?.zoneKey
    ? { town: props.town, zoneKey: props.zoneKey, zone: ZONES[props.zoneKey], slug: ville }
    : findCityBySlug(ville);

if (!resolvedCity) throw new Error(`Ville inconnue: ${ville}`);

const svc = (SERVICES as any)[service] as typeof SERVICES[ServiceKey] | undefined;
if (!svc) throw new Error(`Service inconnu: ${service}`);

const { town, zoneKey, zone, slug } = resolvedCity;
const canonical = `${baseUrl}${Astro.url.pathname}`;

const title = `${svc.name} à ${town} – Pros animaux (${zone.name}) | Horizon Conversion`;
const description =
  `${svc.name} à ${town} : ${svc.headline} Zone : ${zone.name}. Tracking inclus pour relier SEO/Maps/Ads aux leads.`;

const breadcrumbs = [
  { name: "Accueil", item: `${baseUrl}/` },
  { name: "Zones", item: `${baseUrl}/zones/` },
  { name: zone.name, item: `${baseUrl}/zones/${zoneKey}/` },
  { name: town, item: `${baseUrl}/zones/${slug}/` },
  { name: svc.name, item: canonical },
];

const faq = [
  {
    q: `Pourquoi ${svc.name} est pertinent à ${town} ?`,
    a: "Parce que les recherches locales sont très “intentionnelles” : l’utilisateur veut appeler / réserver / demander un RDV. Une page dédiée + tracking améliore le taux de conversion.",
  },
  {
    q: "Combien de temps pour voir des résultats ?",
    a: "En général : Ads = plus rapide (jours/semaines). SEO/Maps = durable (semaines/mois), mais on peut accélérer via pages ultra ciblées et GBP optimisée.",
  },
  {
    q: "Comment prouver l’impact ?",
    a: "Avec un tracking clair : clic-to-call, formulaires, UTM, événements analytics et dashboard leads/coûts/taux.",
  },
];

const jsonLd = [
  {
    "@context": "https://schema.org",
    "@type": "WebPage",
    name: title,
    url: canonical,
    description,
    isPartOf: { "@type": "WebSite", name: "Horizon Conversion Animaux", url: baseUrl },
  },
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    itemListElement: breadcrumbs.map((b, i) => ({
      "@type": "ListItem",
      position: i + 1,
      name: b.name,
      item: b.item,
    })),
  },
  {
    "@context": "https://schema.org",
    "@type": "Service",
    name: `${svc.name} à ${town}`,
    areaServed: [town, zone.name],
    provider: {
      "@type": "Organization",
      name: "Horizon Conversion Animaux",
      url: baseUrl,
      telephone: "+33660921008",
      email: "contact@horizon-conversion.fr",
    },
  },
  {
    "@context": "https://schema.org",
    "@type": "FAQPage",
    mainEntity: faq.map((f) => ({
      "@type": "Question",
      name: f.q,
      acceptedAnswer: { "@type": "Answer", text: f.a },
    })),
  },
];
---

<LayoutSEO
  title={title}
  description={description}
  baseUrl={baseUrl}
  canonical={canonical}
  ogType="website"
  ogImage={`${baseUrl}/og/ville-service-${slug}-${service}.jpg`}
  ogImageAlt={`${svc.name} à ${town} – Horizon Conversion Animaux`}
  breadcrumbs={breadcrumbs}
  jsonLd={jsonLd}
>
<style>
  :global(body){margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial;color:#0f172a;background:#fff}
  .wrap{max-width:1040px;margin:0 auto;padding:28px 16px 72px}
  .breadcrumbs{font-size:14px;color:#475569;margin:4px 0 18px}
  .breadcrumbs a{color:inherit;text-decoration:none}
  header.hero{border:1px solid #e2e8f0;border-radius:18px;background:linear-gradient(180deg,#f8fafc,#fff);padding:22px;display:grid;gap:10px}
  h1{margin:0;font-size:34px;line-height:1.1;letter-spacing:-0.02em}
  .sub{margin:0;color:#334155;max-width:95ch;line-height:1.6}
  .grid{margin-top:18px;display:grid;grid-template-columns:1.15fr .85fr;gap:18px;align-items:start}
  @media (max-width:920px){.grid{grid-template-columns:1fr}}
  .card{border:1px solid #e2e8f0;border-radius:18px;padding:18px;background:#fff;box-shadow:0 6px 20px rgba(15,23,42,.06)}
  h2{margin:0 0 10px;font-size:18px}
  p{margin:0;color:#334155;line-height:1.6}
  ul{margin:10px 0 0;padding-left:18px;color:#334155;line-height:1.55}
  .badge{display:inline-block;font-size:12px;padding:6px 10px;border-radius:999px;border:1px solid #e2e8f0;background:#f1f5f9;color:#334155;font-weight:900;width:fit-content}
  .pills{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
  .pill{display:inline-block;font-size:12px;padding:6px 10px;border-radius:999px;border:1px solid #e2e8f0;background:#fff;color:#334155}
  .ctaRow{margin-top:14px;display:grid;grid-template-columns:1fr 1fr;gap:12px}
  @media (max-width:720px){.ctaRow{grid-template-columns:1fr}}
  .btn{display:inline-flex;align-items:center;justify-content:center;padding:12px 14px;border-radius:14px;border:1px solid #0f172a;background:#0f172a;color:#fff;font-weight:900;text-decoration:none}
  .btn.secondary{background:#fff;color:#0f172a}
  .faq{margin-top:16px}
  .faq details{border:1px solid #e2e8f0;border-radius:16px;padding:12px 14px;background:#fff;margin-bottom:10px}
  .faq summary{cursor:pointer;font-weight:900}
  .faq p{margin:10px 0 0}
</style>

<div class="wrap">
  <nav class="breadcrumbs" aria-label="Fil d’Ariane">
    <a href="/">Accueil</a> <span aria-hidden="true">›</span>{" "}
    <a href="/zones/">Zones</a> <span aria-hidden="true">›</span>{" "}
    <a href={`/zones/${zoneKey}/`}>{zone.name}</a> <span aria-hidden="true">›</span>{" "}
    <a href={`/zones/${slug}/`}>{town}</a> <span aria-hidden="true">›</span>{" "}
    <span>{svc.name}</span>
  </nav>

  <header class="hero">
    <span class="badge">{svc.badge}</span>
    <h1>{svc.name} à {town}</h1>
    <p class="sub">
      {svc.headline} Zone : <strong>{zone.name}</strong>. On relie la performance aux demandes via
      <strong> tracking</strong> (appels, formulaires, sources).
    </p>
  </header>

  <section class="grid">
    <div class="card">
      <h2>Ce que vous obtenez</h2>
      <ul>{svc.deliverables.map((d) => <li>{d}</li>)}</ul>

      <h2 style="margin-top:16px;">Pourquoi ça marche localement</h2>
      <p>
        À {town}, la majorité des requêtes utiles sont “transactionnelles” : la personne cherche un pro près de chez elle
        et veut agir vite (appeler, réserver, demander un RDV). Une page locale dédiée + preuves + CTA = meilleur taux de conversion.
      </p>

      <div class="ctaRow">
        <a class="btn" href="/contact/">Demander un diagnostic</a>
        <a class="btn secondary" href="tel:+33660921008">Appeler : 06 60 92 10 08</a>
      </div>

      <div class="faq" id="faq">
        <h2 style="margin:0 0 10px;">FAQ</h2>
        {faq.map((f) => (
          <details>
            <summary>{f.q}</summary>
            <p>{f.a}</p>
          </details>
        ))}
      </div>
    </div>

    <aside class="card">
      <h2>KPIs suivis</h2>
      <p>On pilote sur des métriques simples, reliées au business.</p>
      <div class="pills">
        {svc.kpis.map((k) => <span class="pill">{k}</span>)}
      </div>

      <h2 style="margin-top:16px;">Raccourcis</h2>
      <div class="pills">
        <a class="pill" href={`/zones/${slug}/`} style="text-decoration:none;">Page ville</a>
        <a class="pill" href={`/zones/${zoneKey}/`} style="text-decoration:none;">Hub zone</a>
        <a class="pill" href={`/prestations/${svc.prestationSlug}/`} style="text-decoration:none;">Prestation</a>
        <a class="pill" href="/tarifs/" style="text-decoration:none;">Tarifs</a>
      </div>
    </aside>
  </section>
</div>
</LayoutSEO>