---
import Layout from "../../layouts/Layout.astro";
import villes from "../../data/villes.json";

const brand = import.meta.env.PUBLIC_BRAND_NAME ?? "Horizon Conversion";
const regionLabel = import.meta.env.PUBLIC_REGION_LABEL ?? "Sud Oise (60) / Nord 95";

const title = `Villes d‚Äôintervention ‚Äî ${regionLabel} | ${brand}`;
const description = `Retrouvez toutes les villes d‚Äôintervention : Sud Oise (60) et Nord 95. D√©pannage, travaux, devis gratuit et rappel rapide.`;
const canonical = "/villes/";

// Tri : A puis B, et alpha
const sortVilles = (arr) =>
  [...arr].sort((a, b) => {
    if (a.priority !== b.priority) return a.priority === "A" ? -1 : 1;
    return a.name.localeCompare(b.name, "fr");
  });

const sudOise = sortVilles(villes.filter((v) => v.zone === "sud-oise"));
const nord95 = sortVilles(villes.filter((v) => v.zone === "nord-95"));

const countA = (arr) => arr.filter((v) => v.priority === "A").length;
---

<Layout title={title} description={description} canonical={canonical}>
  <section class="page-title page-title-center dark include-header include-topbar">
    <div class="container">
      <div class="page-title-row">
        <div class="page-title-content">
          <div class="badge rounded-pill border border-light text-light">Villes</div>
          <h1>Villes d‚Äôintervention</h1>
          <p class="lead mb-0">{regionLabel} ‚Äî devis gratuit & r√©ponse rapide</p>
        </div>

        <nav aria-label="breadcrumb">
          <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/">Accueil</a></li>
            <li class="breadcrumb-item active" aria-current="page">Villes</li>
          </ol>
        </nav>
      </div>
    </div>
  </section>

  <section id="content">
    <div class="content-wrap pb-0">
      <div class="container">

        <!-- Intro -->
        <div class="row justify-content-center">
          <div class="col-lg-9 text-center">
            <div class="badge rounded-pill badge-default mb-2">SEO local</div>
            <h2 class="display-6 fw-bold mb-3">Choisis ta ville</h2>
            <p class="text-muted mb-0">
              Chaque page ville renvoie ensuite vers ‚ÄúVille √ó M√©tier‚Äù puis ‚ÄúService √ó Ville‚Äù pour capter les requ√™tes les plus rentables.
            </p>
          </div>
        </div>

        <div class="clear line my-6"></div>

        <!-- Tabs -->
        <ul class="nav nav-tabs justify-content-center" id="villesTabs" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link active" id="tab-60" data-bs-toggle="tab" data-bs-target="#pane-60" type="button" role="tab" aria-controls="pane-60" aria-selected="true">
              Sud Oise (60) <span class="badge bg-light text-dark ms-2">{sudOise.length}</span>
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="tab-95" data-bs-toggle="tab" data-bs-target="#pane-95" type="button" role="tab" aria-controls="pane-95" aria-selected="false">
              Nord 95 <span class="badge bg-light text-dark ms-2">{nord95.length}</span>
            </button>
          </li>
        </ul>

        <div class="tab-content pt-4" id="villesTabsContent">

          <!-- Sud Oise -->
          <div class="tab-pane fade show active" id="pane-60" role="tabpanel" aria-labelledby="tab-60" tabindex="0">
            <div class="text-center mb-4">
              <div class="small text-muted">
                Priorit√© A (money pages) : <strong>{countA(sudOise)}</strong> ‚Ä¢ Priorit√© B (renfort) : <strong>{sudOise.length - countA(sudOise)}</strong>
              </div>
            </div>

            <div class="row col-mb-20">
              {sudOise.map((v) => (
                <div class="col-lg-3 col-md-4 col-6">
                  <a class={`card h-100 text-decoration-none ${v.priority === "A" ? "border border-2" : ""}`} href={`/villes/${v.slug}/`}>
                    <div class="card-body p-3">
                      <div class="d-flex justify-content-between align-items-start">
                        <div>
                          <div class="fw-semibold">{v.name}</div>
                          <div class="small text-muted">{v.dept} ‚Ä¢ {v.zone}</div>
                        </div>
                        <span class={`badge ${v.priority === "A" ? "bg-success" : "bg-secondary"}`}>
                          {v.priority}
                        </span>
                      </div>

                      {v.around?.length ? (
                        <div class="small text-muted mt-2">
                          Autour : {v.around.slice(0, 4).map((x) => x.replace(/-/g, " ")).join(", ")}{v.around.length > 4 ? "‚Ä¶" : ""}
                        </div>
                      ) : null}
                    </div>
                  </a>
                </div>
              ))}
            </div>
          </div>

          <!-- Nord 95 -->
          <div class="tab-pane fade" id="pane-95" role="tabpanel" aria-labelledby="tab-95" tabindex="0">
            <div class="text-center mb-4">
              <div class="small text-muted">
                Priorit√© A (money pages) : <strong>{countA(nord95)}</strong> ‚Ä¢ Priorit√© B (renfort) : <strong>{nord95.length - countA(nord95)}</strong>
              </div>
            </div>

            <div class="row col-mb-20">
              {nord95.map((v) => (
                <div class="col-lg-3 col-md-4 col-6">
                  <a class={`card h-100 text-decoration-none ${v.priority === "A" ? "border border-2" : ""}`} href={`/villes/${v.slug}/`}>
                    <div class="card-body p-3">
                      <div class="d-flex justify-content-between align-items-start">
                        <div>
                          <div class="fw-semibold">{v.name}</div>
                          <div class="small text-muted">{v.dept} ‚Ä¢ {v.zone}</div>
                        </div>
                        <span class={`badge ${v.priority === "A" ? "bg-success" : "bg-secondary"}`}>
                          {v.priority}
                        </span>
                      </div>

                      {v.around?.length ? (
                        <div class="small text-muted mt-2">
                          Autour : {v.around.slice(0, 4).map((x) => x.replace(/-/g, " ")).join(", ")}{v.around.length > 4 ? "‚Ä¶" : ""}
                        </div>
                      ) : null}
                    </div>
                  </a>
                </div>
              ))}
            </div>
          </div>

        </div>

        <div class="clear line my-6"></div>

        <!-- Bottom CTA -->
        <div class="section mt-0" style="padding: 60px 0;">
          <div class="container">
            <div class="row justify-content-center text-center">
              <div class="col-lg-8">
                <div class="badge rounded-pill badge-default mb-2">Besoin d‚Äôaide ?</div>
                <h3 class="text-transform-none ls-0 mb-3">Pas s√ªr de la ville / du service ?</h3>
                <p class="text-muted mb-4">
                  Va sur la page Contact : UTM + page source + contexte (ville/m√©tier/service) remontent automatiquement dans HubSpot.
                </p>
                <a href="/contact/" class="button button-rounded button-large m-0">üìù Demander un devis</a>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </section>
</Layout>
