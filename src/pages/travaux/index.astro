---
import Layout from "@layouts/Layout.astro";
import travaux from "@data/travaux.json";
import villes from "@data/villes.json";
import metiers from "@data/metiers.json";

const brand = import.meta.env.PUBLIC_BRAND_NAME ?? "Horizon Conversion";
const regionLabel = import.meta.env.PUBLIC_REGION_LABEL ?? "Sud Oise (60) / Nord 95";
const canonical = "/travaux/";

const title = `R√©alisations & interventions ‚Äî ${brand}`;
const description = `Exemples concrets : d√©pannage, installation, r√©novation. Zone ${regionLabel}.`;

const items = [...travaux]
  .sort((a, b) => String(b.date).localeCompare(String(a.date)));

function getVilleName(slug) {
  return villes.find(v => v.slug === slug)?.name ?? slug;
}
function getMetierName(slug) {
  return metiers.find(m => m.slug === slug)?.name ?? slug;
}

// JSON-LD ItemList
const itemListJsonLd = {
  "@context": "https://schema.org",
  "@type": "ItemList",
  "name": `R√©alisations ‚Äî ${brand}`,
  "itemListElement": items.slice(0, 50).map((t, idx) => ({
    "@type": "ListItem",
    "position": idx + 1,
    "name": t.title,
    "url": `${canonical}${t.slug}/`,
  })),
};
---
<Layout title={title} description={description} canonical={canonical} jsonLd={[itemListJsonLd]}>
  <section class="page-title page-title-center dark include-header include-topbar">
    <div class="container">
      <div class="page-title-row">
        <div class="page-title-content">
          <div class="badge rounded-pill border border-light text-light">Travaux</div>
          <h1>R√©alisations & interventions</h1>
          <p class="lead mb-0">{regionLabel} ‚Äî du concret, du local</p>
        </div>

        <nav aria-label="breadcrumb">
          <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/">Accueil</a></li>
            <li class="breadcrumb-item active" aria-current="page">Travaux</li>
          </ol>
        </nav>
      </div>
    </div>
  </section>

  <section id="content">
    <div class="content-wrap pb-0">
      <div class="container">

        <div class="row justify-content-center">
          <div class="col-lg-9 text-center">
            <div class="badge rounded-pill badge-default mb-2">Preuves</div>
            <h2 class="display-6 fw-bold mb-3">Des exemples r√©els</h2>
            <p class="text-muted mb-0">
              Chaque intervention renvoie vers les pages <strong>Ville √ó M√©tier</strong> et <strong>Service √ó Ville</strong> pour un maillage naturel.
            </p>
          </div>
        </div>

        <div class="clear line my-6"></div>

        <div class="row col-mb-30">
          {items.map((t) => (
            <div class="col-lg-4 col-md-6 d-flex">
              <article class="card h-100 w-100">
                {t.photos?.[0] && (
                  <img src={t.photos[0]} alt={t.title} class="card-img-top" loading="lazy" />
                )}
                <div class="card-body p-4">
                  <div class="d-flex flex-wrap gap-2 mb-2">
                    <span class="badge rounded-pill bg-secondary">{getMetierName(t.metier)}</span>
                    <span class="badge rounded-pill bg-light text-dark">{getVilleName(t.ville)}</span>
                    {t.urgent && <span class="badge rounded-pill bg-danger">Urgence</span>}
                  </div>

                  <h3 class="h5 mb-2">
                    <a href={`/travaux/${t.slug}/`}>{t.title}</a>
                  </h3>

                  <p class="small text-muted mb-3">{t.problem}</p>

                  <div class="d-flex flex-wrap gap-2">
                    <a class="button button-rounded button-small m-0" href={`/travaux/${t.slug}/`}>Voir le d√©tail</a>
                    <a class="button button-border button-rounded button-small m-0" href={`/villes/${t.ville}/${t.metier}/`}>Ville √ó M√©tier</a>
                  </div>
                </div>
              </article>
            </div>
          ))}
        </div>

        <div class="clear line my-6"></div>

        <div class="section mt-0" style="padding: 70px 0;">
          <div class="container">
            <div class="row justify-content-center text-center">
              <div class="col-lg-8">
                <div class="badge rounded-pill badge-default mb-2">Devis gratuit</div>
                <h3 class="text-transform-none ls-0 mb-3">Un besoin similaire ?</h3>
                <p class="text-muted mb-4">Explique ta situation, on te rappelle rapidement.</p>
                <a href="/contact/" class="button button-rounded button-large m-0">üìù Demander un devis</a>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </section>
</Layout>
