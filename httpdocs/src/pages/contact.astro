---
// src/pages/contact.astro

import BaseLayout from "../layouts/BaseLayout.astro";
import { getStaticPageByUrl, normalizeLinksOut, resolveFaqItems, safeText } from "../lib/mapping";

import SectionHero from "../components/SectionHero.astro";
import SectionBenefits from "../components/SectionBenefits.astro";
import SectionProcess from "../components/SectionProcess.astro";
import SectionFAQ from "../components/SectionFAQ.astro";
import SectionCTA from "../components/SectionCTA.astro";
import LinksOut from "../components/LinksOut.astro";

const page = getStaticPageByUrl("/contact");

const title = safeText(page?.metaTitle, "Contact | Horizon Conversion");
const description = safeText(page?.metaDescription, "Demander un audit gratuit : SEO local, Ads et CRO.");
const h1 = safeText(page?.h1, "Contact : demander un audit gratuit");

const linksOut = normalizeLinksOut(page?.linksOut);
const faqItems = resolveFaqItems({ pageFaqRefs: page?.faqRefs, pageFaq: page?.faq });
const showFaq = Array.isArray(faqItems) && faqItems.length;

const benefits = [
  "Un plan clair (priorités + quick wins) en 30–60 minutes",
  "On filtre les mauvais leads (zone/services) dès le départ",
  "Vous repartez avec un plan 30 jours actionnable"
];

const process = [
  "Vous envoyez 2–3 infos (activité, zone, objectif)",
  "On fait un point (30–60 min) : visibilité + conversion + tracking",
  "Vous repartez avec un plan 30 jours (priorités + actions)",
  "Si on travaille ensemble : setup puis mensuel (actions + mesure)"
];
---

<BaseLayout
  title={title}
  description={description}
  pageContext={{ type: "static", staticLabel: "Contact", staticUrl: "/contact" }}
  faqItems={faqItems}
>
  <SectionHero
    h1={h1}
    intro="Pas assez d’appels ? Trop de demandes inutiles ? Dites-moi votre zone et vos services : je vous réponds sous 24–48h ouvrées."
    bullets={[
      "Audit gratuit, sans engagement",
      "Interlocuteur unique (senior)",
      "Objectif : demandes qualifiées"
    ]}
  />

  <SectionBenefits items={benefits} />
  <SectionProcess steps={process} />

  <section style="padding:1.5rem 0">
    <div style="max-width:980px;margin:0 auto;padding:0 1rem">
      <h2 style="margin:0 0 .75rem;font-size:1.25rem">Demande</h2>

      <form method="post" action="/contact" style="border:1px solid #e5e7eb;border-radius:14px;padding:1rem;background:#fff;display:grid;gap:.75rem">
        <div style="display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:.75rem">
          <div style="display:grid;gap:.35rem">
            <label for="nom" style="font-weight:600">Nom</label>
            <input id="nom" name="nom" required style="padding:.7rem;border:1px solid #e5e7eb;border-radius:10px" />
          </div>

          <div style="display:grid;gap:.35rem">
            <label for="tel" style="font-weight:600">Téléphone</label>
            <input id="tel" name="tel" inputmode="tel" placeholder="06…" style="padding:.7rem;border:1px solid #e5e7eb;border-radius:10px" />
          </div>
        </div>

        <div style="display:grid;gap:.35rem">
          <label for="email" style="font-weight:600">Email</label>
          <input id="email" name="email" type="email" required style="padding:.7rem;border:1px solid #e5e7eb;border-radius:10px" />
        </div>

        <div style="display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:.75rem">
          <div style="display:grid;gap:.35rem">
            <label for="zone" style="font-weight:600">Zone (ville principale)</label>
            <input id="zone" name="zone" placeholder="Ex : Chantilly" style="padding:.7rem;border:1px solid #e5e7eb;border-radius:10px" />
          </div>

          <div style="display:grid;gap:.35rem">
            <label for="service" style="font-weight:600">Besoin</label>
            <select id="service" name="service" style="padding:.7rem;border:1px solid #e5e7eb;border-radius:10px;background:#fff">
              <option value="">Je ne sais pas</option>
              <option value="seo-local">SEO local (Google/Maps)</option>
              <option value="ads">Google/Meta Ads</option>
              <option value="cro">Optimisation du site (CRO)</option>
            </select>
          </div>
        </div>

        <div style="display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:.75rem">
          <div style="display:grid;gap:.35rem">
            <label for="mode" style="font-weight:600">Préférence</label>
            <select id="mode" name="mode" style="padding:.7rem;border:1px solid #e5e7eb;border-radius:10px;background:#fff">
              <option value="rappel">Être rappelé</option>
              <option value="email">Recevoir une réponse par email</option>
            </select>
          </div>

          <div style="display:grid;gap:.35rem">
            <label for="creneau" style="font-weight:600">Créneau de rappel</label>
            <select id="creneau" name="creneau" style="padding:.7rem;border:1px solid #e5e7eb;border-radius:10px;background:#fff">
              <option value="">Peu importe</option>
              <option value="matin">Matin (9h–12h)</option>
              <option value="midi">Midi (12h–14h)</option>
              <option value="apres-midi">Après-midi (14h–18h)</option>
            </select>
          </div>
        </div>

        <div style="display:grid;gap:.35rem">
          <label for="message" style="font-weight:600">Votre situation (1–2 phrases)</label>
          <textarea id="message" name="message" rows="4" placeholder="Ex : pas assez d’appels / trop de demandes hors zone / besoin urgent…" style="padding:.7rem;border:1px solid #e5e7eb;border-radius:10px"></textarea>
        </div>

        <button type="submit" style="padding:.85rem 1rem;border-radius:12px;border:0;background:#111827;color:#fff;font-weight:800;cursor:pointer">
          Demander un audit gratuit
        </button>

        <div style="display:grid;gap:.25rem;color:#6b7280;font-size:.95rem">
          <div>Réponse sous 24–48h ouvrées. Audit sans engagement.</div>
          <div>On ne revend pas vos données. Si ce n’est pas pertinent, on vous le dit.</div>
        </div>
      </form>
    </div>
  </section>

  {showFaq ? <SectionFAQ items={faqItems} /> : null}
  <LinksOut links={linksOut} />

  <SectionCTA />
</BaseLayout>