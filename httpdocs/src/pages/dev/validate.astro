---
import { runValidation } from "../../lib/validate";

const report = runValidation();
const status = report.ok ? "OK" : "ERREURS";
---

<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Validation datas â€” {status}</title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 2rem; color:#111827; }
      .badge { display:inline-block; padding:.25rem .5rem; border-radius:999px; font-weight:700; font-size:.85rem; }
      .ok { background:#dcfce7; color:#166534; }
      .ko { background:#fee2e2; color:#991b1b; }
      .box { border:1px solid #e5e7eb; border-radius:12px; padding:1rem 1.25rem; margin:1rem 0; background:#fafafa; }
      h1 { margin:0 0 1rem; }
      h2 { margin:0 0 .75rem; font-size:1.05rem; }
      ul { margin:.25rem 0 0; padding-left:1.25rem; }
      code, pre { background:#111827; color:#e5e7eb; padding:.75rem; border-radius:10px; display:block; overflow:auto; }
      .muted { color:#6b7280; }
      .grid { display:grid; grid-template-columns: repeat(3, minmax(0, 1fr)); gap: .75rem; }
      .stat { border:1px solid #e5e7eb; border-radius:12px; padding:.75rem 1rem; background:#fff; }
      .stat b { display:block; font-size:1.2rem; }
      @media (max-width: 900px) { .grid { grid-template-columns: 1fr; } }
    </style>
  </head>
  <body>
    <h1>
      Validation des datas
      <span class={`badge ${report.ok ? "ok" : "ko"}`}>{status}</span>
    </h1>

    <p class="muted">
      VÃ©rifie: slugs, cohÃ©rence villesâ†”zones, compatibilitÃ© seo-mapping (urls + entitÃ©s).
    </p>

    <div class="grid">
      {Object.entries(report.stats).map(([k, v]) => (
        <div class="stat">
          <span class="muted">{k}</span>
          <b>{v}</b>
        </div>
      ))}
    </div>

    <div class="box">
      <h2>Erreurs ({report.errors.length})</h2>
      {report.errors.length ? (
        <ul>
          {report.errors.map((e) => <li>{e}</li>)}
        </ul>
      ) : (
        <p class="muted">Aucune erreur ðŸŽ‰</p>
      )}
    </div>

    <div class="box">
      <h2>Avertissements ({report.warnings.length})</h2>
      {report.warnings.length ? (
        <ul>
          {report.warnings.map((w) => <li>{w}</li>)}
        </ul>
      ) : (
        <p class="muted">Aucun avertissement.</p>
      )}
    </div>

    <div class="box">
      <h2>JSON brut</h2>
      <pre>{JSON.stringify(report, null, 2)}</pre>
    </div>
  </body>
</html>