---
// src/pages/urgence/guides/[metier]/[ville].astro
import Layout from "../../../../layouts/Layout.astro";
import IntentionAnimation from "../../../../components/IntentionAnimation.astro";
import metiers from "../../../../data/metiers.json";
import villes from "../../../../data/villes.json";
import intentions from "../../../../data/intentions.json";

// 1. G√©n√©rer tous les chemins possibles
export async function getStaticPaths() {
  const paths = [];

  for (const metier of metiers) {
    for (const ville of villes) {
      paths.push({
        params: {
          metier: metier.id,
          ville: ville.id
        },
        props: { metier, ville }
      });
    }
  }
  return paths;
}

// 2. R√©cup√©rer les props
const { metier, ville } = Astro.props;
const intentionData = intentions[metier.id]?.intentions.informationnelle;
const persona = intentions[metier.id]?.persona;

// 3. Titre et description
const titre = `Guide gratuit : SEO pour ${metier.nomCourt} √† ${ville.nom}`;
const description = `T√©l√©chargez notre guide gratuit pour ${metier.nomCourt} √† ${ville.nom}. Apprenez les bases du SEO local adapt√© √† votre m√©tier.`;
---

<Layout title={titre} description={description}>
  <!-- Hero -->
  <section class="bg-gradient-to-br from-green-50 to-emerald-50 py-20">
    <div class="container-custom text-center">
      <IntentionAnimation intention="informationnelle" type="badge" class="mb-6">
        üìö GUIDE GRATUIT
      </IntentionAnimation>

      <h1 class="text-5xl font-bold mb-6">
        Guide SEO pour <span class="text-primary-600">{metier.nomCourt}</span> √† {ville.nom}
      </h1>

      <p class="text-xl text-gray-700 mb-8 max-w-3xl mx-auto">
        {intentionData?.description || "T√©l√©chargez notre guide complet et apprenez √† √™tre visible dans votre ville."}
      </p>
    </div>
  </section>

  <!-- Contenu du guide -->
  <section class="py-20">
    <div class="container-custom">
      <div class="grid md:grid-cols-2 gap-12">
        <!-- Colonne gauche : infos guide -->
        <div>
          <div class="bg-white p-8 rounded-xl shadow-sm sticky top-24">
            <h2 class="text-2xl font-bold mb-4">Dans ce guide :</h2>

            <ul class="space-y-4 mb-8">
              <li class="flex items-start gap-3">
                <span class="text-primary-600 text-xl">üìò</span>
                <span><strong>Chapitre 1 :</strong> Pourquoi le SEO local est crucial pour les {metier.nomCourt}</span>
              </li>
              <li class="flex items-start gap-3">
                <span class="text-primary-600 text-xl">üìç</span>
                <span><strong>Chapitre 2 :</strong> √ätre visible sur Google Maps √† {ville.nom}</span>
              </li>
              <li class="flex items-start gap-3">
                <span class="text-primary-600 text-xl">‚≠ê</span>
                <span><strong>Chapitre 3 :</strong> La strat√©gie d'avis</span>
              </li>
              <li class="flex items-start gap-3">
                <span class="text-primary-600 text-xl">üîß</span>
                <span><strong>Chapitre 4 :</strong> Les pages par service</span>
              </li>
              <li class="flex items-start gap-3">
                <span class="text-primary-600 text-xl">üåç</span>
                <span><strong>Chapitre 5 :</strong> Les villages alentours</span>
              </li>
              <li class="flex items-start gap-3">
                <span class="text-primary-600 text-xl">‚úÖ</span>
                <span><strong>Bonus :</strong> Checklist en 30 points</span>
              </li>
            </ul>

            <div class="bg-gray-50 p-4 rounded-lg mb-6">
              <p class="text-sm text-gray-600">üìÑ PDF de 45 pages ‚Ä¢ 2.4 Mo ‚Ä¢ Mis √† jour en 2025</p>
            </div>

            <!-- Formulaire de t√©l√©chargement -->
            <form class="space-y-4" id="download-guide-form">
              <input
                  type="text"
                  placeholder="Votre pr√©nom"
                  class="w-full px-4 py-3 rounded-lg border border-gray-200 focus:outline-none focus:border-primary-500"
                  required
              />
              <input
                  type="email"
                  placeholder="Votre email professionnel"
                  class="w-full px-4 py-3 rounded-lg border border-gray-200 focus:outline-none focus:border-primary-500"
                  required
              />
              <label class="flex items-start gap-2 text-sm text-gray-600">
                <input type="checkbox" required class="mt-1" />
                <span>J'accepte de recevoir le guide et des informations par email</span>
              </label>
              <IntentionAnimation intention="informationnelle" type="button">
                <button type="submit" class="w-full">
                  T√©l√©charger le guide gratuit
                </button>
              </IntentionAnimation>
            </form>

            <p class="text-xs text-gray-500 text-center mt-4">
              üîí 100% gratuit - D√©sinscription √† tout moment
            </p>
          </div>
        </div>

        <!-- Colonne droite : aper√ßu et extrait -->
        <div>
          <div class="bg-gray-100 p-6 rounded-xl mb-8">
            <h3 class="text-xl font-bold mb-4">Extrait du guide</h3>
            <div class="bg-white p-6 rounded-lg">
              <p class="text-gray-700 italic mb-4">
                "√Ä {ville.nom}, la concurrence entre {metier.nomCourt} est r√©elle. Mais peu d'entre eux optimisent correctement leur pr√©sence en ligne. C'est votre opportunit√©."
              </p>
              <p class="text-gray-700">
                Dans ce guide, vous apprendrez les 12 actions concr√®tes √† mettre en place pour appara√Ætre dans le pack local Google Maps.
              </p>
            </div>
          </div>

          <div class="bg-primary-50 p-6 rounded-xl">
            <h3 class="text-xl font-bold mb-4">Vous pr√©f√©rez un accompagnement personnalis√© ?</h3>
            <p class="text-gray-700 mb-4">
              Je propose un audit gratuit pour analyser votre situation √† {ville.nom} et vous recommander les actions prioritaires.
            </p>
            <a href="/contact" class="btn-primary inline-block">
              Demander mon audit gratuit
            </a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Script de tracking -->
  <script>
    document.getElementById('download-guide-form')?.addEventListener('submit', async (e) => {
      e.preventDefault();

      const button = e.target.querySelector('button');
      const originalText = button.innerText;

      button.disabled = true;
      button.innerText = 'T√©l√©chargement...';

      // Simuler t√©l√©chargement
      await new Promise(resolve => setTimeout(resolve, 1000));

      // Cr√©er lien fictif
      const link = document.createElement('a');
      link.href = `/guides/${metier.id}-${ville.id}.pdf`;
      link.download = `guide-${metier.id}-${ville.id}.pdf`;
      link.click();

      // Tracking conversion
      if (window.trackConversion) {
        window.trackConversion('download', 10);
      }

      button.innerText = '‚úì T√©l√©charg√© !';
      setTimeout(() => {
        button.innerText = originalText;
        button.disabled = false;
      }, 3000);
    });
  </script>
</Layout>