---
// src/pages/profils/[cible].astro
import BaseLayout from "../../layouts/BaseLayout.astro";
import PageTitle from "../../components/PageTitle.astro";
import HeroPage from "../../components/HeroPage.astro";
import ServicesPage from "../../components/ServicesPage.astro";
import ZonesVilles from "../../components/ZonesVilles.astro";
import Ressources from "../../components/Ressources.astro";
import Faqs from "../../components/Faqs.astro";
import ContactForm from "../../components/ContactForm.astro";

import siteData from "../../data/site.json";
import seoData from "../../data/seo.json";
import hero_pageData from "../../data/hero_page.json";
import services_pageData from "../../data/services_page.json";
import zonesData from "../../data/zones.json";
import villesData from "../../data/villes.json";
import articlesData from "../../data/articles.json";
import faqs_ciblesData from "../../data/faqs_cibles.json";
import formData from "../../data/form.json";

// ✅ source des slugs pour générer /profils/:cible/
import ciblesData from "../../data/cibles.json";

/** ✅ getStaticPaths requis pour une route dynamique */
export async function getStaticPaths() {
  const root =
    ciblesData && typeof ciblesData === "object" && !Array.isArray(ciblesData)
      ? ciblesData
      : null;

  if (!root) {
    throw new Error(`[profils/[cible]] cibles.json invalide (objet attendu)`);
  }

  const entries = Object.entries(root)
    .filter(([k, v]) => k !== "_meta" && v && typeof v === "object" && !Array.isArray(v))
    .map(([_, v]) => v)
    .filter((c) => typeof c.slug === "string" && c.slug.trim());

  if (entries.length === 0) {
    throw new Error(`[profils/[cible]] aucune cible trouvée dans cibles.json`);
  }

  return entries.map((c) => ({
    params: { cible: String(c.slug).trim() },
    props: { cibleSlug: String(c.slug).trim() },
  }));
}
---

<BaseLayout>
  <PageTitle />

  <!-- Content ============================================= -->
  <section id="content">
    <div class="content-wrap pb-0">

      <div class="container">

        <HeroPage />

        <ServicesPage />

      </div>

      <div class="clear"></div>

      <ZonesVilles />

      <Ressources />

      <Faqs />

      <ContactForm />

    </div>
  </section>
</BaseLayout>