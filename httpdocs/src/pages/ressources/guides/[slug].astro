---
// src/pages/ressources/guides/[slug].astro
import Layout from "../../../layouts/Layout.astro";

// 1. D√©finition de tous les guides disponibles
export async function getStaticPaths() {
  const guides = [
    {
      slug: "seo-local-artisans-2025",
      titre: "SEO local pour artisans",
      description: "Le guide complet pour √™tre trouv√© quand les clients cherchent un artisan pr√®s de chez eux.",
      format: "PDF",
      pages: 45,
      taille: "2.4 Mo",
      date: "2025-01-15",
      image: "/images/ressources/guide-artisans.jpg",
      apercu: "/images/ressources/apercu-guide-artisans.jpg",
      niveau: "D√©butant",
      downloads: 1245,
      contenu: [
        "Chapitre 1 : Pourquoi le SEO local est crucial pour les artisans",
        "Chapitre 2 : Google My Business : la fiche parfaite",
        "Chapitre 3 : Les pages par service et par ville",
        "Chapitre 4 : La strat√©gie d'avis",
        "Chapitre 5 : Le netlinking local",
        "Chapitre 6 : Mesurer vos r√©sultats",
        "Bonus : Checklist en 30 points"
      ]
    },
    {
      slug: "google-ads-petits-budgets",
      titre: "Google Ads pour petits budgets",
      description: "Comment rentabiliser vos annonces avec moins de 300‚Ç¨ par mois.",
      format: "PDF",
      pages: 32,
      taille: "1.8 Mo",
      date: "2025-01-10",
      image: "/images/ressources/guide-ads.jpg",
      apercu: "/images/ressources/apercu-guide-ads.jpg",
      niveau: "Interm√©diaire",
      downloads: 892,
      contenu: [
        "Chapitre 1 : Les bases de Google Ads",
        "Chapitre 2 : La g√©olocalisation fine",
        "Chapitre 3 : Les mots-cl√©s n√©gatifs",
        "Chapitre 4 : Le budget minimal efficace",
        "Chapitre 5 : Les annonces saisonni√®res",
        "Chapitre 6 : Le retargeting l√©ger",
        "Bonus : Template de campagne"
      ]
    },
    {
      slug: "avis-google-importance",
      titre: "Guide des avis Google",
      description: "Obtenez plus d'avis et g√©rez votre e-r√©putation efficacement.",
      format: "PDF",
      pages: 28,
      taille: "1.5 Mo",
      date: "2025-01-05",
      image: "/images/ressources/guide-avis.jpg",
      apercu: "/images/ressources/apercu-guide-avis.jpg",
      niveau: "D√©butant",
      downloads: 1567,
      contenu: [
        "Chapitre 1 : Pourquoi les avis sont cruciaux",
        "Chapitre 2 : Comment demander des avis",
        "Chapitre 3 : R√©pondre aux avis n√©gatifs",
        "Chapitre 4 : Les avis et le r√©f√©rencement",
        "Chapitre 5 : Les outils de gestion",
        "Bonus : Mod√®les de r√©ponses"
      ]
    },
    {
      slug: "cro-pour-professions-liberales",
      titre: "CRO pour professions lib√©rales",
      description: "Transformez vos visiteurs en rendez-vous clients.",
      format: "PDF",
      pages: 38,
      taille: "2.1 Mo",
      date: "2024-12-20",
      image: "/images/ressources/guide-cro.jpg",
      apercu: "/images/ressources/apercu-guide-cro.jpg",
      niveau: "Avanc√©",
      downloads: 734,
      contenu: [
        "Chapitre 1 : Les sp√©cificit√©s des professions lib√©rales",
        "Chapitre 2 : Le formulaire de contact id√©al",
        "Chapitre 3 : Les t√©moignages strat√©giques",
        "Chapitre 4 : La preuve sociale",
        "Chapitre 5 : Les appels √† l'action",
        "Chapitre 6 : Analyse et tests A/B",
        "Bonus : Checklist d'audit CRO"
      ]
    }
  ];

  return guides.map((guide) => ({
    params: { slug: guide.slug },
    props: { guide }
  }));
}

// 2. R√©cup√©rer les props
const { guide } = Astro.props;

// 3. Guides similaires (pour la fin de page)
const guidesSimilaires = [
  {
    slug: "seo-local-artisans-2025",
    titre: "SEO local pour artisans"
  },
  {
    slug: "avis-google-importance",
    titre: "Guide des avis Google"
  }
];
---

<Layout title={`${guide.titre} - Guide gratuit | Horizon Conversion`} description={guide.description}>
  <div class="container-custom py-12 max-w-5xl">
    <!-- Fil d'ariane -->
    <nav class="text-sm text-gray-600 mb-8">
      <a href="/" class="hover:text-primary-600">Accueil</a> ‚Ä∫
      <a href="/ressources" class="hover:text-primary-600">Ressources</a> ‚Ä∫
      <a href="/ressources/guides" class="hover:text-primary-600">Guides</a> ‚Ä∫
      <span class="text-gray-900">{guide.titre}</span>
    </nav>

    <div class="grid md:grid-cols-2 gap-12">
      <!-- Colonne gauche : infos et formulaire -->
      <div>
        <h1 class="text-4xl font-bold mb-4">{guide.titre}</h1>

        <!-- Badges -->
        <div class="flex flex-wrap gap-2 mb-4">
          <span class="bg-primary-100 text-primary-700 px-3 py-1 rounded-full text-xs">{guide.niveau}</span>
          <span class="bg-gray-100 text-gray-700 px-3 py-1 rounded-full text-xs">{guide.format} ‚Ä¢ {guide.pages} pages</span>
          <span class="bg-gray-100 text-gray-700 px-3 py-1 rounded-full text-xs">üì• {guide.downloads} t√©l√©chargements</span>
        </div>

        <p class="text-xl text-gray-700 mb-6">{guide.description}</p>

        <!-- M√©triques -->
        <div class="bg-gray-50 p-6 rounded-xl mb-6">
          <div class="grid grid-cols-3 gap-4 text-center">
            <div>
              <div class="text-3xl font-bold text-primary-600">{guide.pages}</div>
              <div class="text-sm text-gray-600">pages</div>
            </div>
            <div>
              <div class="text-3xl font-bold text-primary-600">{guide.taille}</div>
              <div class="text-sm text-gray-600">taille</div>
            </div>
            <div>
              <div class="text-3xl font-bold text-primary-600">{guide.format}</div>
              <div class="text-sm text-gray-600">format</div>
            </div>
          </div>
        </div>

        <!-- Sommaire -->
        <h2 class="text-xl font-bold mb-4">Au sommaire :</h2>
        <ul class="space-y-2 mb-8 bg-white p-6 rounded-xl border border-gray-100">
          {guide.contenu.map(item => (
              <li class="flex items-start gap-2">
                <span class="text-primary-600 mt-1">‚úì</span>
                <span class="text-gray-700">{item}</span>
              </li>
          ))}
        </ul>

        <!-- Formulaire de t√©l√©chargement -->
        <div class="bg-primary-50 p-6 rounded-xl sticky top-24">
          <h3 class="text-xl font-bold mb-4">T√©l√©charger le guide gratuit</h3>
          <p class="text-sm text-gray-600 mb-4">Recevez le guide imm√©diatement par email.</p>

          <form class="space-y-4" method="POST" action="/api/download-guide" id="download-form">
            <input
                type="text"
                name="prenom"
                placeholder="Votre pr√©nom"
                class="w-full px-4 py-3 rounded-lg border border-gray-200 focus:outline-none focus:border-primary-500"
                required
            />
            <input
                type="email"
                name="email"
                placeholder="Votre email professionnel"
                class="w-full px-4 py-3 rounded-lg border border-gray-200 focus:outline-none focus:border-primary-500"
                required
            />

            <label class="flex items-start gap-2 text-sm text-gray-600">
              <input type="checkbox" name="consent" required class="mt-1" />
              <span>J'accepte de recevoir le guide et des informations par email (d√©sinscription possible √† tout moment)</span>
            </label>

            <button type="submit" class="btn-primary w-full py-4 text-lg">
              T√©l√©charger maintenant
            </button>
          </form>

          <p class="text-xs text-gray-500 text-center mt-4">
            üîí 100% gratuit - Pas de spam
          </p>
        </div>
      </div>

      <!-- Colonne droite : aper√ßu -->
      <div>
        <div class="sticky top-24">
          <div class="bg-gray-100 rounded-xl p-4 aspect-[3/4] flex items-center justify-center shadow-lg">
            <img
                src={guide.apercu}
                alt={guide.titre}
                class="max-w-full max-h-full object-contain rounded-lg shadow-md"
                onerror="this.src='https://placehold.co/600x800/2563eb/white?text=' + encodeURIComponent(guide.titre)"
            />
          </div>
          <p class="text-sm text-gray-500 text-center mt-2">Aper√ßu du guide</p>

          <!-- Guides similaires -->
          <div class="mt-8 p-4 bg-gray-50 rounded-xl">
            <h3 class="font-bold mb-3">Vous aimerez aussi :</h3>
            <div class="space-y-2">
              {guidesSimilaires.map(guideSim => (
                  <a
                      href={`/ressources/guides/${guideSim.slug}`}
                      class="block p-2 hover:bg-white rounded-lg transition-colors"
                  >
                    <p class="font-medium text-sm">{guideSim.titre}</p>
                    <p class="text-xs text-primary-600">T√©l√©charger ‚Üí</p>
                  </a>
              ))}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Gestionnaire du formulaire de t√©l√©chargement
    document.getElementById('download-form')?.addEventListener('submit', async (e) => {
      e.preventDefault();

      const form = e.target;
      const button = form.querySelector('button');
      const originalText = button.innerText;

      // D√©sactiver le bouton
      button.disabled = true;
      button.innerText = 'T√©l√©chargement en cours...';

      try {
        // Simuler l'appel API
        await new Promise(resolve => setTimeout(resolve, 1000));

        // Cr√©er un lien de t√©l√©chargement fictif (√† remplacer par vrai t√©l√©chargement)
        const link = document.createElement('a');
        link.href = `/guides/${guide.slug}.pdf`;
        link.download = `${guide.slug}.pdf`;
        link.click();

        // Afficher message de succ√®s
        button.innerText = '‚úì T√©l√©charg√© !';

        // Suivi de conversion
        if (window.trackConversion) {
          window.trackConversion('download', 10);
        }

        setTimeout(() => {
          button.innerText = originalText;
          button.disabled = false;
        }, 3000);

      } catch (error) {
        button.innerText = 'Erreur - R√©essayer';
        setTimeout(() => {
          button.innerText = originalText;
          button.disabled = false;
        }, 2000);
      }
    });
  </script>
</Layout>