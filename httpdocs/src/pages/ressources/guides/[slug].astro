---
import Layout from "../../../layouts/Layout.astro";
import GuideSchema from "../../../components/GuideSchema.astro";
import guides from "../../../data/guides.json";

export async function getStaticPaths() {
  return guides.map(guide => ({
    params: { slug: guide.slug },
    props: { guide }
  }));
}

const { guide } = Astro.props;

// Guides similaires : exclure le guide actuel, prendre 2 autres al√©atoirement
const guidesSimilaires = guides
  .filter(g => g.slug !== guide.slug)
  .sort(() => 0.5 - Math.random())
  .slice(0, 2);
---

<Layout title={`${guide.titre} - Guide gratuit | Horizon Conversion`} description={guide.description}>

  <GuideSchema guide={guide} />

  <div class="container-custom py-12 max-w-5xl">
    <!-- Fil d'ariane -->
    <nav class="text-sm text-gray-600 mb-8">
      <a href="/" class="hover:text-primary-600">Accueil</a> ‚Ä∫
      <a href="/ressources" class="hover:text-primary-600">Ressources</a> ‚Ä∫
      <a href="/ressources/guides" class="hover:text-primary-600">Guides</a> ‚Ä∫
      <span class="text-gray-900">{guide.titre}</span>
    </nav>

    <div class="grid md:grid-cols-2 gap-12">
      <!-- Colonne gauche : infos et formulaire -->
      <div>
        <h1 class="text-4xl font-bold mb-4">{guide.titre}</h1>

        <!-- Badges -->
        <div class="flex flex-wrap gap-2 mb-4">
          <span class="bg-primary-100 text-primary-700 px-3 py-1 rounded-full text-xs">{guide.niveau}</span>
          <span class="bg-gray-100 text-gray-700 px-3 py-1 rounded-full text-xs">{guide.format} ‚Ä¢ {guide.pages} pages</span>
          <span class="bg-gray-100 text-gray-700 px-3 py-1 rounded-full text-xs">üì• {guide.downloads} t√©l√©chargements</span>
        </div>

        <p class="text-xl text-gray-700 mb-6">{guide.description}</p>

        <!-- M√©triques -->
        <div class="bg-gray-50 p-6 rounded-xl mb-6">
          <div class="grid grid-cols-3 gap-4 text-center">
            <div>
              <div class="text-3xl font-bold text-primary-600">{guide.pages}</div>
              <div class="text-sm text-gray-600">pages</div>
            </div>
            <div>
              <div class="text-3xl font-bold text-primary-600">{guide.taille}</div>
              <div class="text-sm text-gray-600">taille</div>
            </div>
            <div>
              <div class="text-3xl font-bold text-primary-600">{guide.format}</div>
              <div class="text-sm text-gray-600">format</div>
            </div>
          </div>
        </div>

        <!-- Sommaire -->
        <h2 class="text-xl font-bold mb-4">Au sommaire :</h2>
        <ul class="space-y-2 mb-8 bg-white p-6 rounded-xl border border-gray-100">
          {guide.contenu.map(item => (
              <li class="flex items-start gap-2">
                <span class="text-primary-600 mt-1">‚úì</span>
                <span class="text-gray-700">{item}</span>
              </li>
          ))}
        </ul>

        <!-- Formulaire de t√©l√©chargement -->
        <div class="bg-primary-50 p-6 rounded-xl sticky top-24">
          <h3 class="text-xl font-bold mb-4">T√©l√©charger le guide gratuit</h3>
          <p class="text-sm text-gray-600 mb-4">Recevez le guide imm√©diatement par email.</p>

          <form class="space-y-4" id="guide-form" name="guide-form" action="/include/form.php" method="post">

            <div class="form-process">
              <div class="css3-spinner">
                <div class="css3-spinner-scaler"></div>
              </div>
            </div>

            <input
                type="text"
                id="guide-form-name"
                name="guide-form-name"
                placeholder="Votre pr√©nom"
                class="w-full px-4 py-3 rounded-lg border border-gray-200 focus:outline-none focus:border-primary-500"
                required
            />
            <input
                type="email"
                id="guide-form-email"
                name="guide-form-email"
                placeholder="Votre email professionnel"
                class="w-full px-4 py-3 rounded-lg border border-gray-200 focus:outline-none focus:border-primary-500"
                required
            />

            <label class="flex items-start gap-2 text-sm text-gray-600" for="guide-form-check">
              <input type="checkbox" id="guide-form-check" name="guide-form-check" required class="mt-1" />
              <span>J'accepte de recevoir le guide et des informations par email (d√©sinscription possible √† tout moment)</span>
            </label>

            <input class="hidden" type="text" id="guide-form-botcheck" name="guide-form-botcheck">

            <input type="hidden" id="g-recaptcha-response" name="g-recaptcha-response">

            <script src="https://www.google.com/recaptcha/api.js?render=6LeL4HsUAAAAAP-TtLxY0OHX0ykl9p_mAvslYWJM"></script>
            <script>
              grecaptcha.ready(function() {
                grecaptcha.execute('6LeL4HsUAAAAAP-TtLxY0OHX0ykl9p_mAvslYWJM', {action: 'contact_page'}).then(function(token) {
                  // add token value to form
                  document.getElementById('g-recaptcha-response').value = token;
                });
              });
            </script>

            <button class="btn-primary w-full py-4 text-lg" type="submit" id="guide-form-submit" name="guide-form-submit" value="submit">
              T√©l√©charger maintenant
            </button>

            <input type="hidden" name="prefix" value="guide-form-">
          </form>

          <p class="text-xs text-gray-500 text-center mt-4">
            üîí 100% gratuit - Pas de spam
          </p>
        </div>
      </div>

      <!-- Colonne droite : aper√ßu -->
      <div>
        <div class="sticky top-24">
          <div class="bg-gray-100 rounded-xl p-4 aspect-[3/4] flex items-center justify-center shadow-lg">
            <img
                src={guide.apercu}
                alt={guide.titre}
                class="max-w-full max-h-full object-contain rounded-lg shadow-md"
                onerror="this.src='https://placehold.co/600x800/2563eb/white?text=' + encodeURIComponent(guide.titre)"
            />
          </div>
          <p class="text-sm text-gray-500 text-center mt-2">Aper√ßu du guide</p>

          <!-- Guides similaires -->
          {guidesSimilaires.length > 0 && (
              <div class="mt-8 p-4 bg-gray-50 rounded-xl">
                <h3 class="font-bold mb-3">Vous aimerez aussi :</h3>
                <div class="space-y-2">
                  {guidesSimilaires.map(guideSim => (
                      <a
                          href={`/ressources/guides/${guideSim.slug}`}
                          class="block p-2 hover:bg-white rounded-lg transition-colors"
                      >
                        <p class="font-medium text-sm">{guideSim.titre}</p>
                        <p class="text-xs text-primary-600">T√©l√©charger ‚Üí</p>
                      </a>
                  ))}
                </div>
              </div>
          )}
        </div>
      </div>
    </div>
  </div>
</Layout>