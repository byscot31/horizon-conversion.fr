---
// src/pages/zones/index.astro

import BaseLayout from "../../layouts/BaseLayout.astro";
import { getStaticPageByUrl, normalizeLinksOut, resolveFaqItems, safeText } from "../../lib/mapping";

import SectionHero from "../../components/SectionHero.astro";
import SectionBenefits from "../../components/SectionBenefits.astro";
import SectionDeliverables from "../../components/SectionDeliverables.astro";
import SectionProcess from "../../components/SectionProcess.astro";
import SectionFAQ from "../../components/SectionFAQ.astro";
import SectionCTA from "../../components/SectionCTA.astro";
import LinksOut from "../../components/LinksOut.astro";

const page = getStaticPageByUrl("/zones");

const title = safeText(page?.metaTitle, "Zones | Horizon Conversion");
const description = safeText(page?.metaDescription, "Sud Oise & Val d’Oise (95) : SEO local, Ads et CRO.");
const h1 = safeText(page?.h1, "Zones couvertes");

const linksOut = normalizeLinksOut(page?.linksOut);

const benefits = [
  "Pages locales utiles (intention claire), pas du contenu dupliqué",
  "Couverture ville + alentours (sans sur-optimisation)",
  "Système mesuré : appels, formulaires, qualité des leads"
];

const deliverables = [
  "Plan d’action par zone (priorités & quick wins)",
  "Maillage interne pensé conversion",
  "Tracking simple et lisible"
];

const process = [
  "Audit gratuit (zone, concurrence, opportunités)",
  "Plan 30 jours",
  "Exécution + reporting mensuel"
];

// ✅ FAQ: faqRefs
const faqItems = resolveFaqItems({ pageFaqRefs: page?.faqRefs, pageFaq: page?.faq });
const showFaq = Array.isArray(faqItems) && faqItems.length;
---

<BaseLayout
  title={title}
  description={description}
  pageContext={{ type: "zonesIndex" }}
  faqItems={faqItems}
>
  <SectionHero
    h1={h1}
    intro="Sud Oise et Val d’Oise (95). Objectif : générer des demandes qualifiées avec SEO local, Ads et CRO."
    bullets={[
      "Pages locales = intention réelle",
      "Conversion mobile-first",
      "Suivi simple et transparent"
    ]}
  />

  <SectionBenefits items={benefits} />
  <SectionDeliverables items={deliverables} />
  <SectionProcess steps={process} />

  {showFaq ? <SectionFAQ items={faqItems} /> : null}
  <LinksOut links={linksOut} />

  <SectionCTA />
</BaseLayout>