---
// src/pages/zones/[zone]/index.astro
import BaseLayout from "../../../layouts/BaseLayout.astro";
import PageTitle from "../../../components/PageTitle.astro";
import HeroPage from "../../../components/HeroPage.astro";
import ServicesPage from "../../../components/ServicesPage.astro";
import Villes from "../../../components/Villes.astro";
import Faqs from "../../../components/Faqs.astro";
import ContactForm from "../../../components/ContactForm.astro";

import siteData from "../../../data/site.json";
import seoData from "../../../data/seo.json";
import hero_pageData from "../../../data/hero_page.json";
import servicesData from "../../../data/services.json";
import zonesData from "../../../data/zones.json";
import villesData from "../../../data/villes.json";
import faqs_zonesData from "../../../data/faqs_zones.json";
import formData from "../../../data/form.json";

/** ✅ getStaticPaths requis pour /zones/[zone]/ */
export async function getStaticPaths() {
  const root =
    zonesData && typeof zonesData === "object" && !Array.isArray(zonesData)
      ? zonesData
      : null;

  if (!root) {
    throw new Error(`[zones/[zone]] zones.json invalide (objet attendu)`);
  }

  const zonesRoot =
    root.zones && typeof root.zones === "object" && !Array.isArray(root.zones)
      ? root.zones
      : null;

  if (!zonesRoot) {
    throw new Error(`[zones/[zone]] zones.json.zones manquant (objet attendu)`);
  }

  const zonesList = Object.values(zonesRoot).filter(
    (z) =>
      z &&
      typeof z === "object" &&
      !Array.isArray(z) &&
      typeof z.slug === "string" &&
      z.slug.trim()
  );

  if (zonesList.length === 0) {
    throw new Error(`[zones/[zone]] aucune zone trouvée dans zones.json.zones`);
  }

  return zonesList.map((z) => ({
    params: { zone: String(z.slug).trim() },
    props: { zoneSlug: String(z.slug).trim() },
  }));
}
---

<BaseLayout>
  <PageTitle />

  <!-- Content ============================================= -->
  <section id="content">
    <div class="content-wrap pb-0">

      <!-- Hero + Services ============================================= -->
      <div class="container mb-5">

        <HeroPage />

        <ServicesPage />

      </div>

      <div class="clear"></div>

      <Villes />

      <Faqs />
      <ContactForm />
    </div>
  </section>
</BaseLayout>