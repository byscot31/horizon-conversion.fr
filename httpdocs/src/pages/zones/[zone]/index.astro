---
// src/pages/zones/[zone]/index.astro
import BaseLayout from "../../../layouts/BaseLayout.astro";
import PageTitle from "../../../components/PageTitle.astro";
import HeroPage from "../../../components/HeroPage.astro";
import VillesPage from "../../../components/VillesPage.astro";
import Villes from "../../../components/Villes.astro";
import Faqs from "../../../components/Faqs.astro";
import ContactForm from "../../../components/ContactForm.astro";
import MaillageInterne from "../../../components/MaillageInterne.astro";

import { buildModel } from "../../../lib/pageModel";
import { zones, villes, services } from "../../../lib/data";
import { bySlug } from "../../../lib/collection";

export function getStaticPaths() {
  return (zones ?? []).map((z) => ({ params: { zone: z.slug } }));
}

const zoneSlug = Astro.params.zone;
const zone = bySlug(zones, zoneSlug, "zones");

const canonical = `/zones/${zone.slug}/`;

const model = buildModel({
  type: "zone",
  zone,
  canonical,
});

const contexte = model.contexte;

const seo = {
  ...model.seo,
  title: `Zone ${zone.name} | ${model.site.name}`,
  description: `Obtenir plus de demandes dans la zone ${zone.name} : pages efficaces + suivi des appels et formulaires + leviers (SEO local / Ads). Audit gratuit.`,
  canonical,
};

const breadcrumbItems = model.breadcrumbItems ?? [
  { label: "Accueil", href: "/" },
  { label: "Zones", href: "/zones/" },
  { label: zone.name ?? zone.slug, href: canonical },
];

const villesZone = (villes ?? []).filter((v) => v.zoneSlug === zone.slug);
---

<BaseLayout seo={seo} site={model.site}>
  <PageTitle
      contexte={contexte}
      seo={seo}
      breadcrumbItems={breadcrumbItems}
      data={{
        badge: "Zone",
        h1: `Générer plus de demandes — ${zone.name}`,
        chapo: zone.excerpt ?? seo.description,
      }}
  />

  <section id="content">
    <div class="content-wrap pb-0">

      <div class="container mb-5">
        <HeroPage data={model.hero.page} contexte={contexte} />
        <VillesPage data={services} contexte={contexte} config={{ title: "Services utiles", subtitle: "Choisir un levier" }} />
      </div>

      <div class="clear"></div>

      <Villes data={villesZone} zone={zone} contexte={contexte} />

      <Faqs
          items={model.faqs}
          data={{ badge: "FAQ", title: `Questions fréquentes — ${zone.name}`, intro: "Réponses simples et concrètes." }}
          contexte={contexte}
      />

      <ContactForm data={model.site} form={model.blocks.form} contexte={contexte} mode="audit" />

      <MaillageInterne data={model.blocks.maillageInterne} contexte={contexte} />

    </div>
  </section>
</BaseLayout>
