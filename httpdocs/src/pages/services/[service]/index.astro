---
// src/pages/[service]/index.astro
import BaseLayout from "../../../layouts/BaseLayout.astro";
import PageTitle from "../../../components/PageTitle.astro";
import SectionHero from "../../../components/SectionHero.astro";
import SectionBenefices from "../../../components/SectionBenefices.astro";
import SectionVilles from "../../../components/SectionVilles.astro";
import SectionMethode from "../../../components/SectionMethode.astro";
import SectionFaqs from "../../../components/SectionFaqs.astro";
import SectionPromo from "../../../components/SectionPromo.astro";
import services from "../../../data/services.json";
import villes from "../../../data/villes.json";

export function getStaticPaths() {
  return services.map((s) => ({ params: { service: s.slug }, props: { serviceData: s } }));
}

const { serviceData } = Astro.props;
const serviceSlug = Astro.params.service;

const serviceObj = serviceData ?? services.find((s) => s.slug === serviceSlug);
if (!serviceObj) throw new Error(`Service introuvable: ${serviceSlug}`);

// SEO
const pageTitle = `${serviceObj.nom} | Sud Oise & Val d’Oise 95`;
const description =
  serviceObj.promesse
    ? `${serviceObj.promesse} — Sud Oise & Nord 95. Audit gratuit, livrables clairs, suivi mensuel.`
    : `Service ${serviceObj.nom} — Sud Oise & Nord 95. Audit gratuit, livrables clairs, suivi mensuel.`;

const canonical = Astro.url.pathname; // canonical relatif (robuste si Astro.site absent)

const contactHref = `/contact?service=${encodeURIComponent(serviceObj.slug)}`;

const badge = serviceObj.pageTitleBadge ?? serviceObj.nom;
const title = serviceObj.h1 ?? serviceObj.nom;

// Fallback subtitle si non défini
const subtitle =
  serviceObj.pageTitleSubtitle ??
  `${serviceObj.promesse ?? "Un plan simple, des livrables et un suivi mensuel."} Audit gratuit, réponses claires, actions concrètes.`;

// Image dynamique si tu l’ajoutes au JSON
const image = serviceObj.heroImage ?? "/_assets_/images/hero/hero-1.jpg";

const breadcrumbs = [
  { label: "Accueil", href: "/" },
  { label: "Services", href: "/#services" }, // ou une vraie page /services si tu la crées
  { label: serviceObj.nom }
];
---

<BaseLayout title={pageTitle} description={description} canonical={canonical}>

  <PageTitle
      badge={badge}
      title={title}
      subtitle={subtitle}
      image={image}
      primaryCta={{ label: "Demander un audit gratuit", href: contactHref }}
      secondaryCta={{ label: "Être rappelé", href: contactHref, icon: true }}
      breadcrumbs={breadcrumbs}
    />

  <!-- Content -->
  <section id="content">
    <div class="content-wrap pb-0">

      <SectionHero service={serviceObj} />

      <SectionBenefices />

      <SectionVilles />

      <SectionMethode />

      <SectionFaqs />

      <SectionPromo />

    </div>
  </section>

</BaseLayout>