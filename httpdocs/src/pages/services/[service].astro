---
// src/pages/services/[service].astro
import BaseLayout from "../../layouts/BaseLayout.astro";
import PageTitle from "../../components/PageTitle.astro";
import HeroBenefices from "../../components/HeroBenefices.astro";
import Tarifs from "../../components/Tarifs.astro";
import Preuves from "../../components/Preuves.astro";
import Methode from "../../components/Methode.astro";
import ZonesVilles from "../../components/ZonesVilles.astro";
import Ressources from "../../components/Ressources.astro";
import Faqs from "../../components/Faqs.astro";
import ContactForm from "../../components/ContactForm.astro";

import siteData from "../../data/site.json";
import seoData from "../../data/seo.json";
import hero_benefData from "../../data/hero_benef.json";
import tarifsData from "../../data/tarifs.json";

// ✅ source des slugs pour générer /services/:service/
import servicesData from "../../data/services.json";

import zonesData from "../../data/zones.json";
import villesData from "../../data/villes.json";
import articlesData from "../../data/articles.json";
import faqs_servicesData from "../../data/faqs_services.json";
import formData from "../../data/form.json";

/** ✅ getStaticPaths requis pour une route dynamique */
export async function getStaticPaths() {
  const root =
    servicesData && typeof servicesData === "object" && !Array.isArray(servicesData)
      ? servicesData
      : null;

  if (!root) {
    throw new Error(`[services/[service]] services.json invalide (objet attendu)`);
  }

  const entries = Object.entries(root)
    .filter(([k, v]) => k !== "_meta" && v && typeof v === "object" && !Array.isArray(v))
    .map(([_, v]) => v)
    .filter((svc) => typeof svc.slug === "string" && svc.slug.trim());

  if (entries.length === 0) {
    throw new Error(`[services/[service]] aucun service trouvé dans services.json`);
  }

  return entries.map((svc) => ({
    params: { service: String(svc.slug).trim() },
    props: { serviceSlug: String(svc.slug).trim() },
  }));
}
---

<BaseLayout>
  <PageTitle />

  <!-- Content ============================================= -->
  <section id="content">
    <div class="content-wrap pb-0">

      <HeroBenefices />

      <Tarifs />

      <Preuves />

      <Methode />

      <ZonesVilles />

      <Ressources />

      <Faqs />

      <ContactForm />

    </div>
  </section>
</BaseLayout>