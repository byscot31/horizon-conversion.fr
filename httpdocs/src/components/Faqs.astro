---
// src/components/Faqs.astro
const { items, data, contexte } = Astro.props;

// tu peux soit passer items=[], soit data={title, intro, items}
const list = Array.isArray(items) ? items : (Array.isArray(data?.items) ? data.items : []);
const badge = data?.badge ?? "FAQ";
const h2 = data?.title ?? "Questions fréquentes";
const intro = data?.intro ?? "Réponses simples aux questions qu’on nous pose souvent.";

const jsonLd = list.length > 0 ? {
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": list.map((f) => ({
    "@type": "Question",
    "name": String(f.q ?? f.question ?? "").trim(),
    "acceptedAnswer": {
      "@type": "Answer",
      "text": String(f.a ?? f.answer ?? "").trim(),
    },
  })).filter((x) => x.name && x.acceptedAnswer.text),
} : null;

if (!list.length) {
  // si pas de questions, ne rien afficher
}
---

{list.length > 0 && (
<>
  {jsonLd && (
    <script type="application/ld+json" set:html={JSON.stringify(jsonLd)} />
  )}

  <div class="container mt-5 mb-5">
    <div class="row justify-content-center">
      <div class="col-xl-6 col-lg-8 text-center">
        <div class="heading-block border-bottom-0 text-center mx-auto">
          <div class="badge rounded-pill badge-default">{badge}</div>
          <h2 class="text-transform-none ls-0 mb-3">{h2}</h2>
          <p>{intro}</p>
        </div>
      </div>

      <div class="clear"></div>

      <div class="col-lg-10">
        <div id="faqs" class="faqs">
          {list.map((f) => (
              <div class="toggle faq pb-3 mb-4">
                <div class="toggle-header">
                  <div class="toggle-icon color">
                    <i class="toggle-closed bi-question-circle"></i>
                    <i class="toggle-open bi-question-circle"></i>
                  </div>
                  <div class="toggle-title fw-semibold ps-1">
                    {f.q ?? f.question ?? "Question"}
                  </div>
                  <div class="toggle-icon color">
                    <i class="toggle-closed fa-solid fa-chevron-down text-black-50"></i>
                    <i class="toggle-open fa-solid fa-chevron-up color"></i>
                  </div>
                </div>
                <div class="toggle-content text-black-50 ps-4">
                  {f.a ?? f.answer ?? ""}
                </div>
              </div>
          ))}
        </div>
      </div>

    </div>
  </div>

  <div class="clear"></div>
</>
  )}
