---
// src/components/ServicesPage.astro
const { data, contexte, page } = Astro.props;

const services = Array.isArray(data) ? data : (data?.items ?? []);
if (!services.length) {
  // rien
}

const badge = page?.hero?.kicker ?? "Services";
const h2 = page?.hero?.title ?? "Choisir le bon levier";
const intro = page?.intro?.text ?? "";

const maxItems = page?.maxItems ?? 9;

// ✅ NEW: href intelligent (comme ServicesZones)
const zoneSlug = contexte?.zone?.slug;
const villeSlug = contexte?.ville?.slug;

function serviceHref(serviceSlug) {
  // Si on a zone+ville => page locale, sinon page service générique
  if (zoneSlug && villeSlug) return `/zones/${zoneSlug}/${villeSlug}/${serviceSlug}/`;
  return `/services/${serviceSlug}/`;
}
---

{services.length > 0 && (
<>
  <div class="heading-block border-bottom-0 text-center">
    <div class="badge rounded-pill badge-default">{badge}</div>
    <h2 class="text-transform-none ls-0">{h2}</h2>
    {intro && <p class="text-muted mb-0">{intro}</p>}
  </div>

  <div class="clear"></div>

  <div class="row mt-4 col-mb-50 mb-5">
    {services.slice(0, maxItems).map((s) => (
        <div class="col-sm-6 col-lg-4">
          <div class="feature-box">
            <div class="fbox-icon mb-4">
              <a href={serviceHref(s.slug)}>
                <img
                    src={s.icon ?? "/assets/images/icons/seo.svg"}
                    alt={s.name ?? "Service"}
                    class="bg-transparent rounded-0"
                />
              </a>
            </div>
            <div class="fbox-content">
              <h3 class="text-transform-none">
                <a class="link-dark h-text-color" href={serviceHref(s.slug)}>
                  {s.name ?? "Service"}
                </a>
              </h3>
              <p>{s.excerpt ?? ""}</p>
            </div>
          </div>
        </div>
    ))}
  </div>
</>
  )}
