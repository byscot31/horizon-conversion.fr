---
// src/components/BreadcrumbList.astro

export type BreadcrumbItem = {
  name: string;
  url?: string; // optionnel pour le dernier item (actif)
};

type Props = {
  items: BreadcrumbItem[];
  withSchema?: boolean; // par dÃ©faut: true
  baseUrl?: string; // ton domaine (pour URLs absolues dans le JSON-LD)
};

const {
  items = [],
  withSchema = true,
  baseUrl = "https://horizon-conversion.fr",
} = Astro.props;

const toAbsolute = (u?: string) => {
  if (!u) return undefined;
  if (u.startsWith("http://") || u.startsWith("https://")) return u;
  return new URL(u, baseUrl).toString();
};

const breadcrumbJsonLd =
  withSchema && items.length > 0
    ? {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        itemListElement: items.map((it, i) => ({
          "@type": "ListItem",
          position: i + 1,
          name: it.name,
          item: toAbsolute(it.url ?? ""), // Google aime bien l'URL absolue
        })),
      }
    : null;
---

<nav aria-label="breadcrumb">
  <ol class="breadcrumb">
    {items.map((item, index) => {
      const isLast = index === items.length - 1;

      return (
        <li
          class={`breadcrumb-item${isLast ? " active" : ""}`}
          aria-current={isLast ? "page" : undefined}
        >
          {isLast || !item.url ? (
            item.name
          ) : (
            <a href={item.url}>{item.name}</a>
          )}
        </li>
      );
    })}
  </ol>
</nav>

{breadcrumbJsonLd && (
  <script type="application/ld+json" set:html={JSON.stringify(breadcrumbJsonLd)} />
)}