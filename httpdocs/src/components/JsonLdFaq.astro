// src/components/JsonLdFaq.astro
import site from "../data/site.json";
import faqs from "../data/faqs.json";
import { resolveByIds } from "../lib/resolve";

const { faqIds = [], canonical = "" } = Astro.props;

const baseUrl = site?.url || "";
const url = baseUrl ? `${baseUrl}${canonical}` : canonical;

const items = resolveByIds(faqs, faqIds);

const data = {
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": items.map((f) => ({
    "@type": "Question",
    "name": f.q,
    "acceptedAnswer": {
      "@type": "Answer",
      "text": f.a
    }
  })),
  "url": url
};
---

{items.length ? (
  <script type="application/ld+json">
    {JSON.stringify(data)}
  </script>
) : null}
