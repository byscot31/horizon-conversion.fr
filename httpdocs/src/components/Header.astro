---
const { contact, megaServices: megaServicesProp = [], ASSET_BASE = "/_assets_" } = Astro.props;

const defaultMegaServices = [
  {
    href: "/services/seo-local/",
    icon: `${ASSET_BASE}/images/icons/seo.svg`,
    title: "SEO Local (Oise / Nord 95)",
    desc: "Google Business Profile + pages locales + avis : plus d’appels, plus de formulaires.",
    alt: "SEO local Oise",
  },
  {
    href: "/services/google-ads/",
    icon: `${ASSET_BASE}/images/icons/adword.svg`,
    title: "Google Ads (leads rapides)",
    desc: "Campagnes pilotées au coût par lead : appels qualifiés, formulaires, devis.",
    alt: "Google Ads Oise",
  },
  {
    href: "/services/cro/",
    icon: `${ASSET_BASE}/images/icons/experience.svg`,
    title: "CRO (Conversion)",
    desc: "On transforme votre trafic existant en demandes : UX, parcours, formulaires, preuves.",
    alt: "CRO conversion",
  },
  {
    href: "/services/analytics/",
    icon: `${ASSET_BASE}/images/icons/analysis.svg`,
    title: "Tracking & Analytics",
    desc: "GA4, GTM, événements, appels, UTM : décisions basées sur la donnée.",
    alt: "Analytics tracking",
  },
  {
    href: "/services/contenu-seo/",
    icon: `${ASSET_BASE}/images/icons/content_marketing.svg`,
    title: "Contenu SEO",
    desc: "Pages services + pages villes : visibilité locale durable et qualifiée.",
    alt: "Contenu SEO local",
  },
  {
    href: "/services/social/",
    icon: `${ASSET_BASE}/images/icons/social.svg`,
    title: "Social (utile, pas “vanité”)",
    desc: "Contenus orientés demande + retargeting : on relie visibilité et conversion.",
    alt: "Social retargeting",
  },
];

const megaServices =
  Array.isArray(megaServicesProp) && megaServicesProp.length
    ? megaServicesProp
    : defaultMegaServices;

// Header.astro
const path = Astro.url.pathname;

const isHome = path === "/";

// "Ce que je fais" : uniquement la page liste
const isServicesIndex = path === "/services/";

// "Services" (mega) : uniquement les sous-pages
const isServicesMega = path.startsWith("/services/") && path !== "/services/";

const isFaq = path.startsWith("/faqs/");
const isContact = path.startsWith("/contact/");
---

<header id="header" class="transparent-header floating-header header-size-md">
  <div id="header-wrap">
    <div class="container">
      <div class="header-row">

        <div id="logo">
          <a href="/">
            <img class="logo-default py-2" src={`${ASSET_BASE}/images/logo.svg`} alt="Horizon Conversion" />
          </a>
        </div>

        <div class="header-misc">
          <a href="/contact/" class="button button-rounded ms-3 d-none d-sm-block">Demander un audit</a>
        </div>

        <div class="primary-menu-trigger">
          <button class="cnvs-hamburger" type="button" title="Open Mobile Menu">
            <span class="cnvs-hamburger-box"><span class="cnvs-hamburger-inner"></span></span>
          </button>
        </div>

        <nav class="primary-menu with-arrows">
          <ul class="menu-container">
            <li class={`menu-item ${isHome ? "current" : ""}`}>
              <a class="menu-link" href="/"><div>Accueil</div></a>
            </li>

            <li class={`menu-item ${isServicesIndex ? "current" : ""}`}>
              <a class="menu-link" href="/services/"><div>Ce que je fais</div></a>
            </li>

            <li class={`menu-item mega-menu ${isServicesMega ? "current" : ""}`}>
              <a class="menu-link" href="#"><div>Services</div></a>
              <div class="mega-menu-content mega-menu-style-2 px-0">
                <div class="container">
                  <div class="row">
                    {megaServices.map((s) => (
                      <a href={s.href} class="mega-menu-column sub-menu-container col-lg-4 border-bottom h-bg-light py-4">
                        <div class="feature-box">
                          <div class="fbox-icon mb-2">
                            <img src={s.icon} alt={s.alt} class="bg-transparent rounded-0" />
                          </div>
                          <div class="fbox-content">
                            <h3 class="text-transform-none ls-0">{s.title}</h3>
                            <p>{s.desc}</p>
                          </div>
                        </div>
                      </a>
                    ))}
                    <div class="mega-menu-column sub-menu-container col-12 p-0">
                      <a href="/services/" class="button button-rounded button-large text-transform-none ls-0 w-100 text-center m-0 rounded-0 py-3 button-light">
                        Voir tous les services <i class="bi-arrow-right"></i>
                      </a>
                    </div>
                  </div>
                </div>
              </div>
            </li>

            <li class={`menu-item ${isFaq ? "current" : ""}`}>
              <a class="menu-link" href="/faqs/"><div>FAQ</div></a>
            </li>

            <li class={`menu-item ${isContact ? "current" : ""}`}>
              <a class="menu-link" href="/contact/"><div>Contact</div></a>
            </li>
          </ul>
        </nav>

      </div>
    </div>
  </div>
  <div class="header-wrap-clone"></div>
</header>