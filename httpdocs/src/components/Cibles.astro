---
// src/components/Cibles.astro
const { data, contexte, page } = Astro.props;

const cibles = Array.isArray(data) ? data : (data?.items ?? []);
if (!cibles.length) {
  // rien
}

const title = page?.title ?? "Profils";
const intro = page?.intro ?? "Choisissez votre profil pour des exemples et réponses adaptées.";

// ✅ NEW: href intelligent
const zoneSlug = contexte?.zone?.slug;
const villeSlug = contexte?.ville?.slug;

function cibleHref(cibleSlug) {
  // si on est sur une page ville : /zones/[zone]/[ville]/[cible]/
  if (zoneSlug && villeSlug) return `/zones/${zoneSlug}/${villeSlug}/${cibleSlug}/`;
  // sinon : page profil globale
  return `/profils/${cibleSlug}/`;
}
---

{cibles.length > 0 && (
<div class="section bg-transparent">
  <div class="container">
    <div class="heading-block border-bottom-0 text-center mb-5">
      <div class="badge rounded-pill badge-default">Profils</div>
      <h2 class="text-transform-none ls-0">{title}</h2>
      <p class="text-muted mb-0">{intro}</p>
    </div>

    <div class="row col-mb-30 align-content-stretch">
      {cibles.map((c) => (
          <div class="col-lg-4 col-md-6 d-flex">
            <a href={cibleHref(c.slug)} class="card h-shadow h-translate-y-sm all-ts w-100">
              <div class="card-body p-5">
                <div class="feature-box flex-column">
                  <div class="fbox-content">
                    <h2 class="text-transform-none ls-0 text-larger mb-0">{c.name ?? "Profil"}</h2>
                    <p class="text-smaller">{c.excerpt ?? "Conseils et exemples adaptés à votre activité."}</p>
                  </div>

                  {Array.isArray(c.bullets) && c.bullets.length > 0 && (
                      <ul class="iconlist ms-3 mt-4 mb-0">
                        {c.bullets.slice(0, 5).map((b) => (
                            <li class="d-block mb-2 text-muted">
                              <i class="fa-solid fa-check text-smaller color me-1"></i> {b}
                            </li>
                        ))}
                      </ul>
                  )}
                </div>
              </div>
            </a>
          </div>
      ))}
    </div>
  </div>
</div>
  )}
