---
// src/components/MiniCases.astro

import casesData from "../data/cases.json";

type Props = {
  title?: string;
  intro?: string;
  limit?: number;
  columns?: 2 | 3;
  tag?: string; // filtre simple (ex: "seo-local" | "ads" | "cro")
};

const {
  title = "Mini-cas (format court)",
  intro = "Contexte → problème → actions → mesure. Sans promesse magique, du concret.",
  limit = 3,
  columns = 3,
  tag
} = Astro.props as Props;

const itemsAll = Array.isArray((casesData as any)?.items) ? (casesData as any).items : [];

const itemsFiltered = tag
  ? itemsAll.filter((c: any) => Array.isArray(c?.tags) && c.tags.includes(tag))
  : itemsAll;

const items = itemsFiltered.slice(0, Math.max(1, limit));

const gridCols =
  columns === 2
    ? "repeat(2,minmax(0,1fr))"
    : "repeat(3,minmax(0,1fr))";
---

<section style="padding:1rem 0">
  <div style="max-width:980px;margin:0 auto;padding:0 1rem">
    <h2 style="margin:0 0 .5rem;font-size:1.25rem">{title}</h2>
    {intro ? <p style="margin:0 0 .75rem;color:#6b7280">{intro}</p> : null}

    <div style={`display:grid;grid-template-columns:${gridCols};gap:.75rem`}>
      {items.map((c: any) => (
        <div style="border:1px solid #e5e7eb;border-radius:12px;padding:1rem;background:#fff">
          <strong style="display:block;margin:0 0 .25rem">{c.titre}</strong>
          <div style="color:#6b7280;font-size:.95rem;margin:0 0 .6rem">
            {c.secteur}{c.zone ? ` • ${c.zone}` : ""}
          </div>

          {c.probleme ? (
            <p style="margin:0 0 .6rem;color:#374151">
              <strong>Problème :</strong> {c.probleme}
            </p>
          ) : null}

          {Array.isArray(c.actions) && c.actions.length ? (
            <div>
              <div style="font-weight:700;margin:0 0 .25rem">Actions</div>
              <ul style="margin:0;padding-left:1.15rem;display:grid;gap:.25rem;color:#374151">
                {c.actions.slice(0, 5).map((a: string) => <li>{a}</li>)}
              </ul>
            </div>
          ) : null}

          {c.mesure ? (
            <div style="margin-top:.6rem;color:#6b7280;font-size:.9rem">
              <strong>Mesuré :</strong> {c.mesure}
            </div>
          ) : null}
        </div>
      ))}
    </div>
  </div>
</section>