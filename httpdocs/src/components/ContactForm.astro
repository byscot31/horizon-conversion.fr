---
// src/components/ContactForm.astro
const { form, data, contexte, mode } = Astro.props;

const m = mode === "callback" ? "callback" : "audit";
const cfg = form?.[m];

if (!cfg) {
  // rien à afficher si form.json absent
}

const badge = cfg?.badge ?? "Contact";
const h2 = cfg?.title ?? "Demander un audit (gratuit)";
const leftText = cfg?.leftText ?? cfg?.subtitle ?? "Réponse sous 24–48h ouvrées.";

const h3 = cfg?.boxTitle ?? "Votre demande";
const fields = Array.isArray(cfg?.fields) ? cfg.fields : [];
const submitLabel = cfg?.submitLabel ?? (m === "callback" ? "Être rappelé" : "Envoyer");

const action = cfg?.action ?? "/assets/include/form.php";
const formId = cfg?.formId ?? "template-contactform";
const prefix = cfg?.prefix ?? "template-contactform-";
---

{cfg && (
<div class="section mb-3" style="background: url('/assets/images/sections/1.jpg') no-repeat center center; background-size: cover; padding: 100px 0;">
  <div class="container">
    <div class="row justify-content-between align-items-center">

      <div class="col-md-6">
        <div class="heading-block border-bottom-0 mb-4">
          <div class="badge rounded-pill badge-default">{badge}</div>
          <h2 class="text-transform-none ls-0">{h2}</h2>
        </div>
        <p>{leftText}</p>

        {data?.phone && (
            <p class="mb-0">
              <strong>Téléphone :</strong>{" "}
              <a
                  data-track="click_phone"
                  href={`tel:${String(data.phone).replaceAll(" ", "")}`}
              >
                {data.phone}
              </a>
            </p>
        )}
        {data?.email && (
            <p class="mb-0">
              <strong>Email :</strong> <a href={`mailto:${data.email}`}>{data.email}</a>
            </p>
        )}
      </div>

      <div class="col-md-6">
        <div class="card shadow-sm">
          <div class="card-body">
            <h3 class="h4 mb-3">{h3}</h3>

            <div class="form-widget">
              <div class="form-result"></div>

              <form
                  class="row mb-0"
                  id={formId}
                  name={formId}
                  action={action}
                  method="post"
                  data-track="form"
                  data-form-mode={m}
              >
                {fields.map((f) => (
                    <div class={`col-12 form-group mb-${f.type === "textarea" ? "4" : "3"}`}>
                      <label for={`${prefix}${f.name}`}>{f.label}{f.required ? ":*" : ":"}</label>

                      {f.type === "textarea" ? (
                          <textarea
                              id={`${prefix}${f.name}`}
                              name={`${prefix}${f.name}`}
                              class={`form-control input-sm ${f.required ? "required" : ""}`}
                              rows={f.rows ?? 4}
                              placeholder={f.placeholder ?? ""}
                          />
                      ) : (
                          <input
                              type={f.type ?? "text"}
                              id={`${prefix}${f.name}`}
                              name={`${prefix}${f.name}`}
                              class={`form-control input-sm ${f.required ? "required" : ""}`}
                              placeholder={f.placeholder ?? ""}
                              value=""
                          />
                      )}
                    </div>
                ))}

                <div class="col-12 form-group mb-0">
                  <button class="button button-rounded w-100 text-transform-none ls-0 m-0" type="submit">
                    {submitLabel}
                  </button>
                </div>

                <input type="hidden" name="prefix" value={prefix} />
              </form>
            </div>

            {cfg?.consentText && (
                <p class="text-muted small mt-3 mb-0">{cfg.consentText}</p>
            )}
          </div>
        </div>
      </div>

    </div>
  </div>
</div>
  )}
