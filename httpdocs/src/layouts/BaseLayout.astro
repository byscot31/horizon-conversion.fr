---
// src/layouts/BaseLayout.astro

export type Seo = {
  title: string;
  description: string;
  canonical?: string;
  robots?: string; // ex: "index,follow"
  lang?: string;   // "fr"
  ogImage?: string;
};

export type BreadcrumbItem = { name: string; url: string };

export interface Props {
  seo: Seo;
  schemaJsonLd?: any[];          // JSON-LD ready to stringify
  breadcrumbs?: BreadcrumbItem[]; // optional if you have a component
  phone?: string;               // "06 00 00 00 00"
  email?: string;               // "contact@..."
  siteName?: string;            // "HC - Webmarketing"
  primaryCtaHref?: string;      // "/contact/?cta=audit"
  secondaryCtaHref?: string;    // "/contact/?cta=rappel"
}

const {
  seo,
  schemaJsonLd = [],
  breadcrumbs = [],
  phone = "06 60 92 10 08",
  email = "contact@horizon-conversion.fr",
  siteName = "Horizon Conversion",
  primaryCtaHref = "/contact/?cta=audit",
  secondaryCtaHref = "/contact/?cta=rappel",
} = Astro.props;

const lang = seo.lang ?? "fr";
const canonical = seo.canonical ?? Astro.url.href;
const robots = seo.robots ?? "index,follow";

function telHref(raw: string) {
  const digits = (raw || "").replace(/[^\d+]/g, "");
  return digits ? `tel:${digits}` : "";
}

// Tracking simple (compatible GTM/GA4 dataLayer)
const inlineTracking = `
  window.dataLayer = window.dataLayer || [];
  const track = (event, params={}) => window.dataLayer.push({ event, ...params });

  document.addEventListener('click', (e) => {
    const a = e.target.closest('a');
    if (!a) return;
    const href = a.getAttribute('href') || '';
    if (href.startsWith('tel:')) track('click_phone', { href });
    if (href.startsWith('mailto:')) track('click_email', { href });
    if (href.includes('whatsapp')) track('click_whatsapp', { href });
  });

  document.addEventListener('submit', (e) => {
    const form = e.target;
    if (form && form.matches('form')) track('form_submit', { form_id: form.id || null });
  });

  document.addEventListener('DOMContentLoaded', () => {
    // optionnel: si tu déclenches un event à l’affichage d’un bloc formulaire
    // track('form_view', { path: location.pathname });
  });
`;
---

<!DOCTYPE html>
<html dir="ltr" lang={lang}>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <meta http-equiv="x-ua-compatible" content="IE=edge" />
  <meta name="author" content={siteName} />
  <meta name="description" content={seo.description} />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="robots" content={robots} />

  <link rel="canonical" href={canonical} />

  <title>{seo.title}</title>

  <!-- OpenGraph (optionnel mais utile) -->
  <meta property="og:site_name" content={siteName} />
  <meta property="og:title" content={seo.title} />
  <meta property="og:description" content={seo.description} />
  <meta property="og:url" content={canonical} />
  <meta property="og:type" content="website" />
  {seo.ogImage ? <meta property="og:image" content={seo.ogImage} /> : null}

  <!-- Font Imports -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;900&display=swap" rel="stylesheet" />

  <!-- Core Style -->
  <link rel="stylesheet" href="/assets/style.css" />
  <link rel="stylesheet" href="/css/font-icons.css" />
  <link rel="stylesheet" href="/css/components/bs-switches.css" />
  <link rel="stylesheet" href="/demos/seo/seo.css" />
  <link rel="stylesheet" href="/css/custom.css" />

  <!-- JSON-LD -->
  {schemaJsonLd?.length
    ? <script type="application/ld+json" set:html={JSON.stringify(schemaJsonLd)} />
    : null}
</head>

<body class="stretched">
  <div id="wrapper">

    <!-- Top Bar -->
    <div id="top-bar" class="transparent-topbar">
      <div class="container">
        <div class="row justify-content-between">
          <div class="col-12 col-md-auto">
            <div class="top-links">
              <ul class="top-links-container">
                <li class="top-links-item"><a href="/">Accueil</a></li>
                <li class="top-links-item"><a href="/services/">Services</a></li>
                <li class="top-links-item"><a href="/zones/">Zones</a></li>
                <li class="top-links-item"><a href="/preuves/">Preuves</a></li>
                <li class="top-links-item"><a href="/contact/">Contact</a></li>
              </ul>
            </div>
          </div>

          <div class="col-12 col-md-auto dark">
            <ul id="top-social">
              {phone ? (
                <li>
                  <a href={telHref(phone)} class="h-bg-call">
                    <span class="ts-icon"><i class="fa-solid fa-phone"></i></span>
                    <span class="ts-text">{phone}</span>
                  </a>
                </li>
              ) : null}

              {email ? (
                <li>
                  <a href={`mailto:${email}`} class="h-bg-email3">
                    <span class="ts-icon"><i class="bi-envelope-fill"></i></span>
                    <span class="ts-text">{email}</span>
                  </a>
                </li>
              ) : null}
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Header -->
    <header id="header" class="transparent-header floating-header header-size-md">
      <div id="header-wrap">
        <div class="container">
          <div class="header-row">
            <div id="logo">
              <a href="/">
                <img class="logo-default" src="/images/logo@2x.png" alt={siteName} />
                <img class="logo-dark" src="/images/logo-dark@2x.png" alt={siteName} />
              </a>
            </div>

            <div class="header-misc">
              <a href={primaryCtaHref} class="button button-rounded ms-3 d-none d-sm-block">
                Demander un audit (gratuit)
              </a>
            </div>

            <div class="primary-menu-trigger">
              <button class="cnvs-hamburger" type="button" title="Ouvrir le menu mobile">
                <span class="cnvs-hamburger-box"><span class="cnvs-hamburger-inner"></span></span>
              </button>
            </div>

            <nav class="primary-menu with-arrows">
              <ul class="menu-container">
                <li class="menu-item"><a class="menu-link" href="/"><div>Accueil</div></a></li>
                <li class="menu-item"><a class="menu-link" href="/methode/"><div>Méthode</div></a></li>
                <li class="menu-item"><a class="menu-link" href="/services/"><div>Services</div></a></li>
                <li class="menu-item"><a class="menu-link" href="/tarifs/"><div>Tarifs</div></a></li>
                <li class="menu-item"><a class="menu-link" href="/preuves/"><div>Preuves</div></a></li>
                <li class="menu-item"><a class="menu-link" href="/contact/"><div>Contact</div></a></li>
              </ul>
            </nav>

          </div>
        </div>
      </div>
      <div class="header-wrap-clone"></div>
    </header>

    <!-- (Optionnel) Breadcrumbs si tu as un composant -->
    {breadcrumbs?.length ? (
      <div class="container mt-4">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb">
            {breadcrumbs.map((b, i) => (
              <li class={`breadcrumb-item ${i === breadcrumbs.length - 1 ? "active" : ""}`}>
                {i === breadcrumbs.length - 1 ? b.name : <a href={b.url}>{b.name}</a>}
              </li>
            ))}
          </ol>
        </nav>
      </div>
    ) : null}

    <!-- CONTENT -->
    <main id="content">
      <section class="content-wrap pt-0">
        <slot />
      </section>
    </main>

    <!-- Footer (light refacto: français + coordonnées) -->
    <footer id="footer" class="border-0" style="background: var(--cnvs-contrast-0);">
      <div class="container">
        <div class="footer-widgets-wrap pb-5">
          <div class="row col-mb-50">
            <div class="col-md-8">
              <div class="widget">
                <img src="/images/footer-widget-logo.png" alt={siteName} class="alignleft" style="margin-top: 8px; padding-right: 18px; border-right: 1px solid #DDD;" />
                <p>
                  Consultant en acquisition locale : SEO local + pages qui transforment, pour générer des <strong>appels</strong> et des <strong>demandes</strong>
                  dans le <strong>Sud Oise (60)</strong> et le <strong>Nord Val d’Oise (95)</strong>.
                </p>

                <div class="line line-sm"></div>

                <div class="row g-4">
                  <div class="col-lg-3 col-6 widget_links">
                    <ul>
                      <li><a href="/">Accueil</a></li>
                      <li><a href="/services/">Services</a></li>
                      <li><a href="/zones/">Zones</a></li>
                      <li><a href="/tarifs/">Tarifs</a></li>
                      <li><a href="/contact/">Contact</a></li>
                    </ul>
                  </div>

                  <div class="col-lg-3 col-6 widget_links">
                    <ul>
                      <li><a href="/preuves/">Preuves</a></li>
                      <li><a href="/methode/">Méthode</a></li>
                      <li><a href="/ressources/">Ressources</a></li>
                      <li><a href="/a-propos/">À propos</a></li>
                    </ul>
                  </div>
                </div>

              </div>
            </div>

            <div class="col-md-4">
              <div class="widget">
                <div class="row">
                  {phone ? (
                    <div class="col-12">
                      <div class="feature-box fbox-plain fbox-sm align-items-center">
                        <div class="fbox-icon"><i class="bi-telephone text-dark"></i></div>
                        <div class="fbox-content">
                          <span class="text-muted">Téléphone :</span><br />
                          <h3 class="text-transform-none ls-0 fw-semibold">{phone}</h3>
                        </div>
                      </div>
                    </div>
                  ) : null}

                  {email ? (
                    <div class="col-12 mt-4">
                      <div class="feature-box fbox-plain fbox-sm align-items-center">
                        <div class="fbox-icon"><i class="bi-envelope text-dark"></i></div>
                        <div class="fbox-content">
                          <span class="text-muted">Email :</span><br />
                          <h3 class="text-transform-none ls-0 fw-semibold">{email}</h3>
                        </div>
                      </div>
                    </div>
                  ) : null}
                </div>
              </div>

              <div class="widget">
                <a href={primaryCtaHref} class="button button-rounded w-100 text-transform-none ls-0 m-0">
                  Demander un audit (gratuit)
                </a>
                <a href={secondaryCtaHref} class="button button-rounded button-light text-dark bg-white border w-100 text-transform-none ls-0 m-0 mt-2">
                  Être rappelé
                </a>
              </div>

            </div>
          </div>
        </div>
      </div>

      <div id="copyrights" style="background: url('/demos/seo/images/hero/footer.svg') no-repeat top center; background-size: cover; padding-top: 70px;">
        <div class="container">
          <div class="row justify-content-between col-mb-30">
            <div class="col-12 col-lg-auto text-center text-lg-start">
              © {new Date().getFullYear()} {siteName}. Tous droits réservés.<br />
              <div class="copyright-links">
                <a href="/mentions-legales/" class="text-contrast-600">Mentions légales</a> /
                <a href="/politique-de-confidentialite/" class="text-contrast-600">Confidentialité</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </footer>
  </div>

  <div id="gotoTop" class="uil uil-angle-up"></div>

  <!-- JS Canvas -->
  <script is:inline src="/js/plugins.min.js"></script>
  <script is:inline src="/js/functions.bundle.js"></script>

  <!-- Tracking -->
  <script is:inline set:html={inlineTracking} />
</body>
</html>
