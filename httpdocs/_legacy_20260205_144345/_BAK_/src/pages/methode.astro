---
// src/pages/methode.astro

import BaseLayout from "../layouts/BaseLayout.astro";
import { getStaticPageByUrl, normalizeLinksOut, resolveFaqItems, safeText } from "../lib/mapping";

import SectionHero from "../components/SectionHero.astro";
import SectionBenefits from "../components/SectionBenefits.astro";
import SectionDeliverables from "../components/SectionDeliverables.astro";
import SectionProcess from "../components/SectionProcess.astro";
import SectionFAQ from "../components/SectionFAQ.astro";
import SectionCTA from "../components/SectionCTA.astro";
import LinksOut from "../components/LinksOut.astro";

const page = getStaticPageByUrl("/methode");

const title = safeText(page?.metaTitle, "Méthode 3C | Horizon Conversion");
const description = safeText(page?.metaDescription, "Captez, Convertissez, Contrôlez : une méthode simple pour générer des demandes locales.");
const h1 = safeText(page?.h1, "La méthode 3C : générer des appels et demandes qualifiés");

const linksOut = normalizeLinksOut(page?.linksOut);
const faqItems = resolveFaqItems({ pageFaqRefs: page?.faqRefs, pageFaq: page?.faq });
const showFaq = Array.isArray(faqItems) && faqItems.length;

const benefits = [
  "Vous arrêtez de “tenter des trucs” : un plan clair et priorisé",
  "Vous filtrez les mauvais leads (hors zone / hors service)",
  "Vous mesurez ce qui rapporte (appels, demandes, sources)"
];

const deliverables = [
  "Audit gratuit : visibilité Google/Maps, Ads (si existantes), pages qui convertissent",
  "Plan 30 jours : quick wins + priorités (impact/effort)",
  "Mise en place : SEO local / Ads / CRO selon votre urgence",
  "Suivi mensuel : journal d’actions + reporting simple"
];

const process = [
  "1) Cadrage : zone, services, délais, objectifs (qualité avant volume)",
  "2) Captez : Google/Maps + Ads si besoin (intention locale)",
  "3) Convertissez : pages qui rassurent et déclenchent l’appel",
  "4) Contrôlez : tracking + décisions mensuelles (on coupe / on garde / on amplifie)"
];
---

<BaseLayout
  title={title}
  description={description}
  pageContext={{ type: "static", staticLabel: "Méthode", staticUrl: "/methode" }}
  faqItems={faqItems}
>
  <SectionHero
    h1={h1}
    intro="Vous avez un site, une fiche Google, parfois des pubs… mais pas assez d’appels ? Le problème vient rarement d’un seul levier. La méthode 3C aligne visibilité + conversion + mesure."
    bullets={[
      "Interlocuteur unique (consultant senior) + exécution d’agence",
      "Des livrables mensuels (pas de flou)",
      "Objectif : demandes utiles, pas du trafic"
    ]}
  />

  <SectionBenefits items={benefits} />
  <SectionDeliverables items={deliverables} />
  <SectionProcess steps={process} />

  {showFaq ? <SectionFAQ items={faqItems} /> : null}
  <LinksOut links={linksOut} />

  <SectionCTA />
</BaseLayout>