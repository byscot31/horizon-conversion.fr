---
// src/layouts/BaseLayout.astro
// Layout basé sur ton template (structure conservée) + contenu dynamique via props.

import services from "../data/services.json";
import specialites from "../data/specialites.json";
import villes from "../data/villes.json";
import zones from "../data/zones.json";

type NavItem = { href: string; label: string };
type SocialItem = { href: string; label: string; iconClass: string; bgClass: string };

type Props = {
  title?: string;
  description?: string;
  canonical?: string;

  // SEO (optionnel)
  noindex?: boolean;

  // OpenGraph/Twitter (optionnel)
  ogImage?: string; // ex: "/_assets_/images/og-default.jpg"
  ogType?: string;  // ex: "website"
  twitterCard?: string; // ex: "summary_large_image"

  // Navigation (optionnel, sinon fallback)
  nav?: NavItem[];
  topLinks?: NavItem[];

  // Contact (optionnel)
  phone?: string;   // ex: "+33 6 00 00 00 00"
  email?: string;   // ex: "contact@horizon-conversion.fr"

  // Social (optionnel)
  socials?: SocialItem[];

  // Schema JSON-LD (optionnel) : objet ou tableau d'objets
  schema?: Record<string, any> | Array<Record<string, any>>;

  // UX
  headerCta?: { href: string; label: string; iconClass?: string }; // bouton header droite
};

const {
  title = "Horizon Conversion | Webmarketing pour entreprises de nettoyage (60/95)",
  description = "SEO local, Google Ads/Meta Ads et optimisation conversion pour entreprises de nettoyage en Sud Oise (60) et Nord 95. Audit gratuit.",
  canonical,
  noindex = false,
  ogImage = "/_assets_/images/og-default.jpg",
  ogType = "website",
  twitterCard = "summary_large_image",
  phone,
  email,
  schema,
  headerCta = { href: "/tarifs", label: "Voir les tarifs", iconClass: "bi-currency-dollar" },
  nav = [
    { href: "/", label: "Accueil" },
    { href: "/methode", label: "Méthode" },
    { href: "/tarifs", label: "Tarifs" },
    { href: "/preuves", label: "Preuves" },
    { href: "/contact", label: "Contact" }
  ],
  topLinks = [
    { href: "/", label: "Accueil" },
    { href: "/ressources", label: "Ressources" },
    { href: "/contact", label: "Contact" }
  ],
  socials = [
    { href: "#", label: "Facebook", iconClass: "fa-brands fa-facebook-f", bgClass: "h-bg-facebook" },
    { href: "#", label: "X", iconClass: "fa-brands fa-x-twitter", bgClass: "h-bg-x-twitter" },
    { href: "#", label: "Instagram", iconClass: "fa-brands fa-instagram", bgClass: "h-bg-instagram" }
  ]
} = Astro.props as Props;

const pageTitle = title?.trim() || "Horizon Conversion";
const pageDesc = (description || "").trim();

// Canonical: si non fourni, on tente de le construire à partir de l’URL courante
const canonicalUrl =
  canonical ||
  (Astro.url?.origin ? new URL(Astro.url.pathname, Astro.url.origin).toString() : undefined);

// JSON-LD (supporte objet ou tableau)
const schemaArray = Array.isArray(schema) ? schema : schema ? [schema] : [];

// helpers
const getVilleName = (slug) => (villes.find((v) => v.slug === slug)?.name ?? slug);

const pickZoneCities = (zoneSlug, max = 6) => {
  const z = zones.find((x) => x.slug === zoneSlug);
  if (!z?.cities?.length) return [];
  return z.cities.slice(0, max).map((citySlug) => ({
    href: `/zones/${zoneSlug}/${citySlug}`,
    label: getVilleName(citySlug),
  }));
};

// --- MENU PRINCIPAL (data-driven) ---
const menu = [
  {
    label: "Services",
    href: "/seo-local",
    children: [
      { label: "SEO Local", href: "/seo-local" },
      { label: "Google / Meta Ads", href: "/google-ads" },
      { label: "Optimisation Site", href: "/cro-tracking" }
    ]
  },
  {
    label: "Marchés",
    href: "/specialites",
    children: (specialites ?? []).slice(0, 6).map((sp) => ({
      label: sp.name,
      href: `/specialites/${sp.slug}`
    }))
  },
  {
    label: "Zones 60/95",
    href: "/zones",
    children: [
      {
        label: "Sud Oise (60)",
        href: "/zones/sud-oise",
        children: pickZoneCities("sud-oise", 6)
      },
      {
        label: "Nord Val-d’Oise (95)",
        href: "/zones/nord-95",
        children: pickZoneCities("nord-95", 6)
      }
    ]
  },
  {
    label: "Ressources",
    href: "/ressources",
    children: [
      { label: "Méthode", href: "/methode" },
      { label: "Preuves", href: "/preuves" },
      { label: "Conseils", href: "/ressources" }
    ]
  },
  { label: "Contact", href: "/contact" }
];

// Active helper
const isActive = (href) => {
  const path = Astro.url?.pathname ?? "/";
  if (href === "/") return path === "/";
  return path === href || path.startsWith(href + "/");
};
---

<!DOCTYPE html>
<html dir="ltr" lang="fr-FR">
<head>

	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<meta http-equiv="x-ua-compatible" content="IE=edge">
	<meta name="author" content="Horizon Conversion">
	<meta name="description" content={pageDesc}>

	{noindex ? <meta name="robots" content="noindex,nofollow" /> : <meta name="robots" content="index,follow" />}

	{canonicalUrl ? <link rel="canonical" href={canonicalUrl} /> : null}

	<!-- OpenGraph -->
	<meta property="og:title" content={pageTitle} />
	<meta property="og:description" content={pageDesc} />
	<meta property="og:type" content={ogType} />
	{canonicalUrl ? <meta property="og:url" content={canonicalUrl} /> : null}
	{ogImage ? <meta property="og:image" content={ogImage} /> : null}

	<!-- Twitter -->
	<meta name="twitter:card" content={twitterCard} />
	<meta name="twitter:title" content={pageTitle} />
	<meta name="twitter:description" content={pageDesc} />
	{ogImage ? <meta name="twitter:image" content={ogImage} /> : null}

	<!-- Font Imports -->
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="http://fonts.googleapis.com/css?family=Heebo:400,500,700" rel="stylesheet">

	<!-- Core Style -->
	<link rel="stylesheet" href="/_assets_/style.css">

	<!-- Font Icons -->
	<link rel="stylesheet" href="/_assets_/css/font-icons.css">

	<!-- Cleaner Theme Custom CSS -->
	<link rel="stylesheet" href="/_assets_/cleaner.css">

	<!-- Custom CSS -->
	<link rel="stylesheet" href="/_assets_/css/custom.css">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<!-- Document Title -->
	<title>{pageTitle}</title>

	<style>
		.form-group > label.error {
			display: block !important;
			text-transform: none;
		}

		.form-group input.valid ~ label.error,
		.form-group input[type="text"] ~ label.error,
		.form-group input[type="email"] ~ label.error,
		.form-group input[type="number"] ~ label.error,
		.form-group select ~ label.error { display: none !important; }
	</style>

  {/* JSON-LD */}
  {schemaArray.map((obj, i) => (
    <script type="application/ld+json" is:inline>
      {JSON.stringify(obj)}
    </script>
  ))}

</head>

<body class="stretched">

	<!-- Document Wrapper -->
	<div id="wrapper">

		<!-- Top Bar -->
		<div id="top-bar">
			<div class="container">

				<div class="row justify-content-between">
					<div class="col-12 col-md-auto">

						<!-- Top Links -->
						<div class="top-links">
							<ul class="top-links-container">
                {topLinks.map((l) => (
								  <li class="top-links-item"><a href={l.href}>{l.label}</a></li>
                ))}
							</ul>
						</div><!-- .top-links end -->

					</div>

					<div class="col-12 col-md-auto">

						<!-- Top Social -->
						<ul id="top-social">
              {socials.map((s) => (
							  <li>
                  <a href={s.href} class={s.bgClass}>
                    <span class="ts-icon"><i class={s.iconClass}></i></span>
                    <span class="ts-text">{s.label}</span>
                  </a>
                </li>
              ))}

              {phone ? (
                <li>
                  <a href={`tel:${phone}`} class="h-bg-call">
                    <span class="ts-icon"><i class="fa-solid fa-phone"></i></span>
                    <span class="ts-text">{phone}</span>
                  </a>
                </li>
              ) : null}

              {email ? (
                <li>
                  <a href={`mailto:${email}`} class="h-bg-email3">
                    <span class="ts-icon"><i class="bi-envelope-fill"></i></span>
                    <span class="ts-text">{email}</span>
                  </a>
                </li>
              ) : null}
						</ul><!-- #top-social end -->

					</div>

				</div>

			</div>

		</div><!-- #top-bar end -->

		<!-- Header -->
		<header id="header" class="full-header header-size-md border-0" data-sticky-shrink="false">

			<div id="header-wrap">
				<div class="container-fluid pe-0">
					<div class="header-row">

						<!-- Logo -->
						<div id="logo" class="col col-sm-auto">
							<a href="/">
								<img class="logo-default" src="/_assets_/images/logo.png" alt="Horizon Conversion">
							</a>
						</div><!-- #logo end -->

						<div class="primary-menu-trigger">
							<button class="cnvs-hamburger" type="button" title="Open Mobile Menu">
								<span class="cnvs-hamburger-box"><span class="cnvs-hamburger-inner"></span></span>
							</button>
						</div>

						<div class="header-misc">
							<a href={headerCta.href} class="button button-light text-dark fw-semibold ls-1 text-uppercase fw-bold">
                {headerCta.iconClass ? <i class={`${headerCta.iconClass} me-1`}></i> : null}
                {headerCta.label}
              </a>
						</div>

						<!-- Primary Navigation -->
						<nav class="primary-menu with-arrows">
                          <ul class="menu-container border-end-0 me-0">
                            {menu.map((item) => (
                              <li class={`menu-item ${isActive(item.href) ? "active" : ""}`}>
                                <a class="menu-link ls-1 text-uppercase fw-bold" href={item.href}>
                                  <div>{item.label}</div>
                                </a>

                                {item.children?.length ? (
                                  <ul class="sub-menu-container">
                                    {item.children.map((child) => (
                                      <li class={`menu-item ${isActive(child.href) ? "active" : ""}`}>
                                        <a class="menu-link" href={child.href}>
                                          <div>{child.label}</div>
                                        </a>

                                        {child.children?.length ? (
                                          <ul class="sub-menu-container">
                                            {child.children.map((grand) => (
                                              <li class={`menu-item ${isActive(grand.href) ? "active" : ""}`}>
                                                <a class="menu-link" href={grand.href}>
                                                  <div>{grand.label}</div>
                                                </a>
                                              </li>
                                            ))}
                                          </ul>
                                        ) : null}
                                      </li>
                                    ))}
                                  </ul>
                                ) : null}
                              </li>
                            ))}
                          </ul>
                        </nav><!-- #primary-menu end -->

					</div>
				</div>
			</div>

			<div class="header-wrap-clone"></div>

		</header><!-- #header end -->

		<slot />

		<!-- Footer -->
		<footer id="footer" class="border-0 dark bg-color">

			<div class="container">

				<!-- Footer Widgets -->
				<div class="footer-widgets-wrap">

					<div class="row">
						<div class="col-12 col-lg-4">
							<img class="mb-5" src="/_assets_/images/logo.png" alt="Horizon Conversion" width="123">
							<p class="text-white-50">
                Horizon Conversion accompagne les entreprises de nettoyage (Sud Oise 60 & Nord 95) sur le SEO local,
                les campagnes Google/Meta et l’optimisation de la conversion (appels & devis).
              </p>
							<div class="d-flex">
                {socials.slice(0, 4).map((s) => (
                  <a href={s.href} class={`social-icon bg-white bg-opacity-25 border-transparent rounded-circle si-small ${s.bgClass}`}>
                    <i class={s.iconClass}></i>
                    <i class={s.iconClass}></i>
                  </a>
                ))}
							</div>
						</div>

						<div class="col-6 col-lg-3 mt-5 mt-lg-0">
							<h4>Services</h4>
							<ul class="list-unstyled mb-0 text-small">
								<li class="mb-2"><a href="/seo-local" class="text-light">SEO local (Google & Maps)</a></li>
								<li class="mb-2"><a href="/google-ads" class="text-light">Google Ads & Meta Ads</a></li>
								<li class="mb-2"><a href="/cro-tracking" class="text-light">CRO & tracking</a></li>
								<li><a href="/tarifs" class="text-light">Tarifs</a></li>
							</ul>
						</div>

						<div class="col-6 col-lg-3 mt-5 mt-lg-0">
							<h4>Ressources</h4>
							<ul class="list-unstyled mb-0 text-small">
								<li class="mb-2"><a href="/ressources" class="text-light">Guides & articles</a></li>
								<li class="mb-2"><a href="/methode" class="text-light">Méthode</a></li>
								<li class="mb-2"><a href="/preuves" class="text-light">Preuves</a></li>
								<li><a href="/zones" class="text-light">Zones (60/95)</a></li>
							</ul>
						</div>

						<div class="col-6 col-lg-2 mt-5 mt-lg-0">
							<h4>À propos</h4>
							<ul class="list-unstyled mb-0 text-small">
								<li class="mb-2"><a href="/contact" class="text-light">Contact</a></li>
								<li class="mb-2"><a href="/mentions-legales" class="text-light">Mentions légales</a></li>
								<li class="mb-2"><a href="/politique-confidentialite" class="text-light">Politique de confidentialité</a></li>
								<li><a class="text-light" href="/tarifs">Tarifs</a></li>
							</ul>
						</div>
					</div>

				</div><!-- .footer-widgets-wrap end -->

			</div>

			<!-- Copyrights -->
			<div id="copyrights" class="dark">

				<div class="container">

					<div class="row align-items-center justify-content-between">
						<div class="col-md-6 text-white-50">
							Copyrights &copy; {new Date().getFullYear()} Horizon Conversion. Tous droits réservés.<br>
							<div class="copyright-links">
                <a href="/mentions-legales" class="text-white-50">Mentions légales</a> /
                <a href="/politique-confidentialite" class="text-white-50">Politique de confidentialité</a>
              </div>
						</div>

						<div class="col-md-6 d-flex justify-content-md-end mt-4 mt-md-0">
							<div class="copyrights-menu copyright-links mb-0">
								<a href="/" class="text-white-50">Accueil</a>/
                <a href="/methode" class="text-white-50">Méthode</a>/
                <a href="/tarifs" class="text-white-50">Tarifs</a>/
                <a href="/contact" class="text-white-50">Contact</a>
							</div>
						</div>
					</div>

				</div>

			</div><!-- #copyrights end -->

		</footer><!-- #footer end -->

	</div><!-- #wrapper end -->

	<!-- Go To Top -->
	<div id="gotoTop" class="uil uil-angle-up rounded-circle bg-color h-bg-dark"></div>

	<!-- JavaScripts -->
	<script is:inline src="/_assets_/js/plugins.min.js"></script>
	<script is:inline src="/_assets_/js/functions.bundle.js"></script>

</body>
</html>